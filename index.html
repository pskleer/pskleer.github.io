<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<!-- 2021-01-12 Tue 10:45 -->
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Computational Aspects in Econometrics: MATLAB</title>
<meta name="generator" content="Org mode" />
<meta name="author" content="Ruud Brekelmans" />
<style type="text/css">
 <!--/*--><![CDATA[/*><!--*/
  .title  { text-align: center;
             margin-bottom: .2em; }
  .subtitle { text-align: center;
              font-size: medium;
              font-weight: bold;
              margin-top:0; }
  .todo   { font-family: monospace; color: red; }
  .done   { font-family: monospace; color: green; }
  .priority { font-family: monospace; color: orange; }
  .tag    { background-color: #eee; font-family: monospace;
            padding: 2px; font-size: 80%; font-weight: normal; }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .org-right  { margin-left: auto; margin-right: 0px;  text-align: right; }
  .org-left   { margin-left: 0px;  margin-right: auto; text-align: left; }
  .org-center { margin-left: auto; margin-right: auto; text-align: center; }
  .underline { text-decoration: underline; }
  #postamble p, #preamble p { font-size: 90%; margin: .2em; }
  p.verse { margin-left: 3%; }
  pre {
    border: 1px solid #ccc;
    box-shadow: 3px 3px 3px #eee;
    padding: 8pt;
    font-family: monospace;
    overflow: auto;
    margin: 1.2em;
  }
  pre.src {
    position: relative;
    overflow: auto;
    padding-top: 1.2em;
  }
  pre.src:before {
    display: none;
    position: absolute;
    background-color: white;
    top: -10px;
    right: 10px;
    padding: 3px;
    border: 1px solid black;
  }
  pre.src:hover:before { display: inline; margin-top: 14px;}
  /* Languages per Org manual */
  pre.src-asymptote:before { content: 'Asymptote'; }
  pre.src-awk:before { content: 'Awk'; }
  pre.src-C:before { content: 'C'; }
  /* pre.src-C++ doesn't work in CSS */
  pre.src-clojure:before { content: 'Clojure'; }
  pre.src-css:before { content: 'CSS'; }
  pre.src-D:before { content: 'D'; }
  pre.src-ditaa:before { content: 'ditaa'; }
  pre.src-dot:before { content: 'Graphviz'; }
  pre.src-calc:before { content: 'Emacs Calc'; }
  pre.src-emacs-lisp:before { content: 'Emacs Lisp'; }
  pre.src-fortran:before { content: 'Fortran'; }
  pre.src-gnuplot:before { content: 'gnuplot'; }
  pre.src-haskell:before { content: 'Haskell'; }
  pre.src-hledger:before { content: 'hledger'; }
  pre.src-java:before { content: 'Java'; }
  pre.src-js:before { content: 'Javascript'; }
  pre.src-latex:before { content: 'LaTeX'; }
  pre.src-ledger:before { content: 'Ledger'; }
  pre.src-lisp:before { content: 'Lisp'; }
  pre.src-lilypond:before { content: 'Lilypond'; }
  pre.src-lua:before { content: 'Lua'; }
  pre.src-matlab:before { content: 'MATLAB'; }
  pre.src-mscgen:before { content: 'Mscgen'; }
  pre.src-ocaml:before { content: 'Objective Caml'; }
  pre.src-octave:before { content: 'Octave'; }
  pre.src-org:before { content: 'Org mode'; }
  pre.src-oz:before { content: 'OZ'; }
  pre.src-plantuml:before { content: 'Plantuml'; }
  pre.src-processing:before { content: 'Processing.js'; }
  pre.src-python:before { content: 'Python'; }
  pre.src-R:before { content: 'R'; }
  pre.src-ruby:before { content: 'Ruby'; }
  pre.src-sass:before { content: 'Sass'; }
  pre.src-scheme:before { content: 'Scheme'; }
  pre.src-screen:before { content: 'Gnu Screen'; }
  pre.src-sed:before { content: 'Sed'; }
  pre.src-sh:before { content: 'shell'; }
  pre.src-sql:before { content: 'SQL'; }
  pre.src-sqlite:before { content: 'SQLite'; }
  /* additional languages in org.el's org-babel-load-languages alist */
  pre.src-forth:before { content: 'Forth'; }
  pre.src-io:before { content: 'IO'; }
  pre.src-J:before { content: 'J'; }
  pre.src-makefile:before { content: 'Makefile'; }
  pre.src-maxima:before { content: 'Maxima'; }
  pre.src-perl:before { content: 'Perl'; }
  pre.src-picolisp:before { content: 'Pico Lisp'; }
  pre.src-scala:before { content: 'Scala'; }
  pre.src-shell:before { content: 'Shell Script'; }
  pre.src-ebnf2ps:before { content: 'ebfn2ps'; }
  /* additional language identifiers per "defun org-babel-execute"
       in ob-*.el */
  pre.src-cpp:before  { content: 'C++'; }
  pre.src-abc:before  { content: 'ABC'; }
  pre.src-coq:before  { content: 'Coq'; }
  pre.src-groovy:before  { content: 'Groovy'; }
  /* additional language identifiers from org-babel-shell-names in
     ob-shell.el: ob-shell is the only babel language using a lambda to put
     the execution function name together. */
  pre.src-bash:before  { content: 'bash'; }
  pre.src-csh:before  { content: 'csh'; }
  pre.src-ash:before  { content: 'ash'; }
  pre.src-dash:before  { content: 'dash'; }
  pre.src-ksh:before  { content: 'ksh'; }
  pre.src-mksh:before  { content: 'mksh'; }
  pre.src-posh:before  { content: 'posh'; }
  /* Additional Emacs modes also supported by the LaTeX listings package */
  pre.src-ada:before { content: 'Ada'; }
  pre.src-asm:before { content: 'Assembler'; }
  pre.src-caml:before { content: 'Caml'; }
  pre.src-delphi:before { content: 'Delphi'; }
  pre.src-html:before { content: 'HTML'; }
  pre.src-idl:before { content: 'IDL'; }
  pre.src-mercury:before { content: 'Mercury'; }
  pre.src-metapost:before { content: 'MetaPost'; }
  pre.src-modula-2:before { content: 'Modula-2'; }
  pre.src-pascal:before { content: 'Pascal'; }
  pre.src-ps:before { content: 'PostScript'; }
  pre.src-prolog:before { content: 'Prolog'; }
  pre.src-simula:before { content: 'Simula'; }
  pre.src-tcl:before { content: 'tcl'; }
  pre.src-tex:before { content: 'TeX'; }
  pre.src-plain-tex:before { content: 'Plain TeX'; }
  pre.src-verilog:before { content: 'Verilog'; }
  pre.src-vhdl:before { content: 'VHDL'; }
  pre.src-xml:before { content: 'XML'; }
  pre.src-nxml:before { content: 'XML'; }
  /* add a generic configuration mode; LaTeX export needs an additional
     (add-to-list 'org-latex-listings-langs '(conf " ")) in .emacs */
  pre.src-conf:before { content: 'Configuration File'; }

  table { border-collapse:collapse; }
  caption.t-above { caption-side: top; }
  caption.t-bottom { caption-side: bottom; }
  td, th { vertical-align:top;  }
  th.org-right  { text-align: center;  }
  th.org-left   { text-align: center;   }
  th.org-center { text-align: center; }
  td.org-right  { text-align: right;  }
  td.org-left   { text-align: left;   }
  td.org-center { text-align: center; }
  dt { font-weight: bold; }
  .footpara { display: inline; }
  .footdef  { margin-bottom: 1em; }
  .figure { padding: 1em; }
  .figure p { text-align: center; }
  .equation-container {
    display: table;
    text-align: center;
    width: 100%;
  }
  .equation {
    vertical-align: middle;
  }
  .equation-label {
    display: table-cell;
    text-align: right;
    vertical-align: middle;
  }
  .inlinetask {
    padding: 10px;
    border: 2px solid gray;
    margin: 10px;
    background: #ffffcc;
  }
  #org-div-home-and-up
   { text-align: right; font-size: 70%; white-space: nowrap; }
  textarea { overflow-x: auto; }
  .linenr { font-size: smaller }
  .code-highlighted { background-color: #ffff00; }
  .org-info-js_info-navigation { border-style: none; }
  #org-info-js_console-label
    { font-size: 10px; font-weight: bold; white-space: nowrap; }
  .org-info-js_search-highlight
    { background-color: #ffff00; color: #000000; font-weight: bold; }
  .org-svg { width: 90%; }
  /*]]>*/-->
</style>
<link rel="stylesheet" type="text/css" href="https://fniessen.github.io/org-html-themes/src/readtheorg_theme/css/htmlize.css"/>
<link rel="stylesheet" type="text/css" href="https://fniessen.github.io/org-html-themes/src/readtheorg_theme/css/readtheorg.css"/>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/js/bootstrap.min.js"></script>
<script type="text/javascript" src="https://fniessen.github.io/org-html-themes/src/lib/js/jquery.stickytableheaders.min.js"></script>
<script type="text/javascript" src="https://fniessen.github.io/org-html-themes/src/readtheorg_theme/js/readtheorg.js"></script>
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-145951205-1"></script>
<script>
window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());

gtag('config', 'UA-145951205-1');
</script>
<script type="text/javascript">
// @license magnet:?xt=urn:btih:e95b018ef3580986a04669f1b5879592219e2a7a&dn=public-domain.txt Public Domain
<!--/*--><![CDATA[/*><!--*/
     function CodeHighlightOn(elem, id)
     {
       var target = document.getElementById(id);
       if(null != target) {
         elem.classList.add("code-highlighted");
         target.classList.add("code-highlighted");
       }
     }
     function CodeHighlightOff(elem, id)
     {
       var target = document.getElementById(id);
       if(null != target) {
         elem.classList.remove("code-highlighted");
         target.classList.remove("code-highlighted");
       }
     }
    /*]]>*///-->
// @license-end
</script>
<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
        displayAlign: "center",
        displayIndent: "0em",

        "HTML-CSS": { scale: 100,
                        linebreaks: { automatic: "false" },
                        webFont: "TeX"
                       },
        SVG: {scale: 100,
              linebreaks: { automatic: "false" },
              font: "TeX"},
        NativeMML: {scale: 100},
        TeX: { equationNumbers: {autoNumber: "AMS"},
               MultLineWidth: "85%",
               TagSide: "right",
               TagIndent: ".8em"
             }
});
</script>
<script type="text/javascript"
        src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-AMS_HTML"></script>
</head>
<body>
<div id="content">
<h1 class="title">Computational Aspects in Econometrics: MATLAB</h1>
<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#orgc8e00a7">1. Overview</a>
<ul>
<li><a href="#orgda7310d">1.1. Prerequisites</a></li>
<li><a href="#org72cab30">1.2. Learning goals</a></li>
<li><a href="#org48e5b6e">1.3. Assignment</a></li>
<li><a href="#org6e2d2e7">1.4. Exam</a></li>
<li><a href="#org2e35b53">1.5. Course material</a></li>
<li><a href="#org5a4a969">1.6. Course setup</a></li>
<li><a href="#org8c5b586">1.7. How to make the exercises?</a></li>
</ul>
</li>
<li><a href="#orgcaaa480">2. Quick refresher</a>
<ul>
<li><a href="#orge5233fb">2.1. Simple creation of arrays:</a></li>
<li><a href="#org106b74f">2.2. Information about sizes and dimensions:</a></li>
<li><a href="#orge372ce4">2.3. Combine variables with right dimensions:</a></li>
<li><a href="#org3948c4a">2.4. Delete rows/columns</a></li>
<li><a href="#org7882fa8">2.5. Implicit expansion and compatible sizes</a></li>
<li><a href="#org4b042b2">2.6. Colon operator:</a></li>
<li><a href="#org6ed710a">2.7. Referencing elements:</a></li>
<li><a href="#orgd881df7">2.8. Matrix operations</a></li>
<li><a href="#orgc3e58bb">2.9. Element-wise operations</a></li>
<li><a href="#org55f416d">2.10. Logical operations</a></li>
<li><a href="#org3584a38">2.11. If/else</a></li>
<li><a href="#org7c38b7a">2.12. For loop</a></li>
<li><a href="#org106827d">2.13. While loop</a></li>
<li><a href="#orge13ac5e">2.14. Script and function m-files</a></li>
</ul>
</li>
<li><a href="#org4dbbbb6">3. Efficient coding</a>
<ul>
<li><a href="#org170c57a">3.1. Introduction</a></li>
<li><a href="#org493d6d2">3.2. Preallocation</a></li>
<li><a href="#org115115a">3.3. Element-wise Arithmetic</a></li>
<li><a href="#org9144651">3.4. Useful functions</a></li>
<li><a href="#org5fdc3d1">3.5. Logical indexing</a></li>
<li><a href="#org07f4981">3.6. Linear indexing</a></li>
<li><a href="#org81062fc">3.7. Matrix creation and transformation</a>
<ul>
<li><a href="#orgd354761">3.7.1. Example: juggling with matrices</a></li>
</ul>
</li>
<li><a href="#orgf0e653e">3.8. Profiling</a></li>
<li><a href="#orgf663e6f">3.9. Debugging</a></li>
<li><a href="#org57bdcc3">3.10. Final remarks</a></li>
<li><a href="#org248a5c8">3.11. Exercises</a>
<ul>
<li><a href="#orgf144adc">3.11.1. Student grades</a></li>
<li><a href="#org56324c3">3.11.2. Euclidean distance</a></li>
<li><a href="#orgdd28a07">3.11.3. Find the bug</a></li>
<li><a href="#org29948ac">3.11.4. Square form</a></li>
<li><a href="#orgb3a7e1d">3.11.5. Run length decoding</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#org0c28213">4. Cells, structures, and other data types</a>
<ul>
<li><a href="#orgc7a317e">4.1. Cells</a></li>
<li><a href="#org8938f92">4.2. Structures</a>
<ul>
<li><a href="#org16f613f">4.2.1. Example: passing multiple arguments to a function</a></li>
</ul>
</li>
<li><a href="#orga442920">4.3. Other data types</a>
<ul>
<li><a href="#org5513b1b">4.3.1. Dates and time</a></li>
<li><a href="#orgc046107">4.3.2. Character and strings arrays</a></li>
<li><a href="#org606427c">4.3.3. Tables</a></li>
</ul>
</li>
<li><a href="#orgb6cb0ff">4.4. Exercises</a>
<ul>
<li><a href="#org951e59c">4.4.1. Reading from a text file</a></li>
<li><a href="#org05f94dd">4.4.2. Combinations totaling to sum</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#orgb11b171">5. Function handles &amp; anonymous functions</a>
<ul>
<li><a href="#org292affb">5.1. Introduction</a></li>
<li><a href="#org82107f3">5.2. Function handles</a></li>
<li><a href="#org7caf192">5.3. Anonymous functions</a></li>
<li><a href="#org41535c2">5.4. Illustrative example</a></li>
<li><a href="#orge082da9">5.5. Exercises</a>
<ul>
<li><a href="#org3b9d088">5.5.1. Piecewise function</a></li>
<li><a href="#org5caac24">5.5.2. Expected value</a></li>
<li><a href="#org8ced988">5.5.3. Solving nonlinear equations</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#org2a2e65b">6. Good coding</a>
<ul>
<li><a href="#org38bbbb0">6.1. Introduction</a></li>
<li><a href="#org546940c">6.2. How to write good code</a>
<ul>
<li><a href="#orgf22e7e7">6.2.1. Allowing higher dimensional inputs than necessary for your original problem</a></li>
<li><a href="#org3364191">6.2.2. Adding additional input arguments that control the behavior of the function</a></li>
<li><a href="#orga4670de">6.2.3. Providing default values for some input variables</a></li>
<li><a href="#org3eaa517">6.2.4. Providing additional output</a></li>
</ul>
</li>
<li><a href="#org2e84df8">6.3. Documenting your code</a>
<ul>
<li><a href="#org8ede617">6.3.1. Function documentation</a></li>
<li><a href="#orgf23c4f2">6.3.2. Local documentation</a></li>
<li><a href="#orgdbf7210">6.3.3. Programming style</a></li>
</ul>
</li>
<li><a href="#orgef5d5aa">6.4. Exercise: restructuring code and adding documentation</a></li>
</ul>
</li>
<li><a href="#orgc845b3b">7. Linear algebra</a>
<ul>
<li><a href="#orgd59507e">7.1. Basic linear algebra in Matlab</a></li>
<li><a href="#org894528b">7.2. Exercises</a>
<ul>
<li><a href="#org8d947f6">7.2.1. Obtaining different solutions to a under-determined linear system</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#org3ff283d">8. Graphics</a>
<ul>
<li><a href="#org8ef8ec9">8.1. Customizing plots</a></li>
<li><a href="#org70be02a">8.2. 3D graphics</a></li>
<li><a href="#orga0c9f2b">8.3. Exercise: probability distributions</a></li>
</ul>
</li>
<li><a href="#orgc4de667">9. Regression</a>
<ul>
<li><a href="#orgd843ae9">9.1. Introduction</a></li>
<li><a href="#org24e0bd7">9.2. Linear regression</a></li>
<li><a href="#orgc29139c">9.3. Nonlinear regression</a></li>
<li><a href="#org71d448e">9.4. Exercises</a>
<ul>
<li><a href="#org6d81458">9.4.1. Nonlinear regression</a></li>
<li><a href="#orgd51bdae">9.4.2. Estimating a full quadratic model using linear regression</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#org7d9b66b">10. Interpolation</a>
<ul>
<li><a href="#org2f89b90">10.1. One-dimensional interpolation</a></li>
<li><a href="#org15cd685">10.2. Higher-dimensional interpolation</a></li>
<li><a href="#orgdcf548f">10.3. Interpolation of scattered data</a></li>
<li><a href="#orgbac8eb8">10.4. Interpolation using Radial Basis Functions</a></li>
<li><a href="#org5f8faf8">10.5. Exercise: interpolation</a></li>
</ul>
</li>
</ul>
</div>
</div>
<div id="outline-container-orgc8e00a7" class="outline-2">
<h2 id="orgc8e00a7"><span class="section-number-2">1</span> Overview</h2>
<div class="outline-text-2" id="text-1">
<p>
This document belongs to the course <i>Computational Aspects in
Econometrics</i>, and specifically the Matlab module of the course. Note
that this page could still be updated during the course. For more
information about the course see Canvas.
</p>

<p>
A university student licencse is available that allows you to install
Matlab on your PC/laptop. For instructions, see <a href="https://servicedesk.uvt.nl/tas/public/ssp/content/detail/knowledgeitem?unid=9c895a61-020c-4692-92a7-96ef357211f7">here</a>.
</p>
</div>

<div id="outline-container-orgda7310d" class="outline-3">
<h3 id="orgda7310d"><span class="section-number-3">1.1</span> Prerequisites</h3>
<div class="outline-text-3" id="text-1-1">
<p>
I expect that you are familiar with the Matlab basics:
</p>
<ul class="org-ul">
<li>basic array operations (vector/matrix)
<ul class="org-ul">
<li>creating, accessing elements, the <code>end</code> index, colon-operator,
deleting columns/rows</li>
</ul></li>
<li>mathematical operations</li>
<li>creating m-files
<ul class="org-ul">
<li>script m-files</li>
<li>function m-files</li>
</ul></li>
<li>programming
<ul class="org-ul">
<li><code>if</code>, <code>for</code>, <code>while</code>, <code>break</code>, <code>continue</code>, <code>switch</code></li>
<li>logical operators: <code>~</code>, <code>&lt;=</code>, <code>&amp;</code>, <code>|</code>, etc.</li>
</ul></li>
<li>basic plotting</li>
<li>important Matlab functions
<ul class="org-ul">
<li><code>eye</code>, <code>ones</code>, <code>zeros</code>, <code>diag</code>, <code>size</code>, <code>length</code>, <code>find</code>, <code>min</code>,
<code>max</code>, <code>sum</code>, <code>sort</code>, <code>any</code>, <code>all</code>, <code>diff</code>, <code>repmat</code>, etc.</li>
</ul></li>
</ul>

<p>
If you lack this basic Matlab knowledge, then you should try to learn
it as soon as possible.  There are many introductory books and tutorial
websites you can choose from.  Here is a short selection:
</p>
<ul class="org-ul">
<li>The official "<a href="http://www.mathworks.nl/help/matlab/getting-started-with-matlab.html">Getting Started with Matlab</a>", which you can also
access through the Matlab help function</li>
<li>Amos Gilat (2011). <a href="http://tilburguniversity.worldcat.org/oclc/741497978">MATLAB: An Introduction with Applications, SI
Version, 4th Edition</a></li>
<li>Matlab <a href="http://www.mathworks.nl/academia/student_center/tutorials/launchpad.html">tutorials</a> on the web</li>
</ul>
</div>
</div>

<div id="outline-container-org72cab30" class="outline-3">
<h3 id="org72cab30"><span class="section-number-3">1.2</span> Learning goals</h3>
<div class="outline-text-3" id="text-1-2">
<p>
Students should be able to&#x2026;
</p>
<ul class="org-ul">
<li>apply the Matlab basics (see prerequisites)</li>
<li>create efficient code by preallocating memory and preventing
unnecessary loops by vectorizing computations, logical indexing and
using functions such as <code>find</code>, <code>reshape</code>, <code>permute</code>, <code>min</code>, <code>max</code>,
<code>sort</code>, <code>all</code>, <code>any</code>, <code>sum</code></li>
<li>use cell and structure arrays</li>
<li>use anonymous functions</li>
<li>function declarations with variable number of input arguments and
default input arguments (<code>varargin</code>, <code>nargin</code>)</li>
<li>import and export data in different formats (e.g. TXT, CSV, MAT
files)</li>
<li>change advanced figure properties (labels, legends, colors, line styles,
etc.)</li>
<li>create 3D-figures (<code>surf</code>, <code>meshgrid</code>, etc.)</li>
<li>write "good" code</li>
<li>use the profiler</li>
<li>use the debugger</li>
<li>use the help function to <i>search for</i> built-in functionality and
<i>use it</i> (I deliberately give exercises during class and in the
assignment for which the solution tool/technique has not been
(fully) explained)</li>
</ul>
</div>
</div>

<div id="outline-container-org48e5b6e" class="outline-3">
<h3 id="org48e5b6e"><span class="section-number-3">1.3</span> Assignment</h3>
<div class="outline-text-3" id="text-1-3">
<p>
The assignment will be announced on Canvas.
</p>

<ul class="org-ul">
<li>Several small exercises</li>
<li>Requirements
<ul class="org-ul">
<li>Efficient (preallocation, vectorize, etc.)</li>
<li>Well-documented
<ul class="org-ul">
<li>Basic function description</li>
<li>Explanation of input/output parameters</li>
<li>Comments on long or non-trivial parts of body</li>
</ul></li>
<li>"Good" code (see <a href="#org2a2e65b">Good coding</a>)</li>
</ul></li>
</ul>
</div>
</div>

<div id="outline-container-org6e2d2e7" class="outline-3">
<h3 id="org6e2d2e7"><span class="section-number-3">1.4</span> Exam</h3>
<div class="outline-text-3" id="text-1-4">
<p>
See <a href="#org72cab30">Learning goals</a>
</p>
</div>
</div>

<div id="outline-container-org2e35b53" class="outline-3">
<h3 id="org2e35b53"><span class="section-number-3">1.5</span> Course material</h3>
<div class="outline-text-3" id="text-1-5">
<p>
Online document&#x2014;the document you are reading now&#x2014;containing several
topics.  For each topic we give
</p>
<ul class="org-ul">
<li>a short introduction and/or some quick illustrations to get the main
idea</li>
<li>references to the official Matlab <a href="http://www.mathworks.nl/help/matlab/index.html">documentation</a>, which you can also
access by using the Matlab help function, and/or other external
online information</li>
<li>the website <a href="http://ubcmatlabguide.github.io/">YAGTOM</a> is a particularly useful reference for the stuff
we are interested in</li>
<li>exercise(s)</li>
</ul>

<p>
Note that you can easily copy the code snippets in this document and
paste them in the Matlab command window, unless it is a function
definition for which you'll need to create a m-file.
</p>
</div>
</div>

<div id="outline-container-org5a4a969" class="outline-3">
<h3 id="org5a4a969"><span class="section-number-3">1.6</span> Course setup</h3>
<div class="outline-text-3" id="text-1-6">
<p>
The Matlab classes have the following setup.
</p>
<ul class="org-ul">
<li>Short introduction to topic</li>
<li>Hands on: solve exercises</li>
<li>Recapture: discuss main issues</li>
<li><i>Selected</i> hints and/or solutions are published on Canvas after
lecture.</li>
</ul>

<p>
As a <i>preparation</i> for the classes, you are asked to <i>read the
documentation and examples</i> provided in this document.  This will give
you a head start during class, because you can start working on the
exercises immediately.  The number of exercises is probably larger
than you can solve during class.  Therefore, some exercises will be
marked as <i>bonus</i> exercises, which are certainly useful but not
crucial to get the main points across.
</p>

<p>
After the classes, you can still work on the excises you could not
finish.  You can ask questions about the exercises next class, or on
the <i>Discussion board</i> on Canvas.
</p>
</div>
</div>

<div id="outline-container-org8c5b586" class="outline-3">
<h3 id="org8c5b586"><span class="section-number-3">1.7</span> How to make the exercises?</h3>
<div class="outline-text-3" id="text-1-7">
<p>
This section gives you a few general tips about how to make the
exercises, or rather how you should do Matlab coding in general.  If
you already have some experience with Matlab, then you might have
picked up a few bad habits as well.
</p>

<p>
There are several ways to work with Matlab:
</p>
<ol class="org-ol">
<li>You can write script m-files and run them from the command line or
directly from the editor.</li>
<li>You can write function m-files and run them from the command line
or call them in a script.</li>
<li>You can type commands on the command line.</li>
<li>You can write script m-files and run so-called sections, marked by
lines starting with <code>%%</code>, from the editor.</li>
<li>You can write script m-files and copy and paste selections to the
command line.</li>
</ol>
<p>
To make things more complicated, you can combine all of the above in
no particular order.  This also means that results could depend
heavily on the workspace at the time you execute that particular piece
of code.
</p>

<p>
It is obvious that this gives you a lot of flexibility, but can also
lead to unstructured results, which may be difficult to replicate as
well. Methods 3, 4, and 5 are okay for developing small pieces of
code, but if you use them too much, you will get confused, and so will
anybody that wants to help you (this could be yours truly). So, try to
prevent methods 3, 4, and 5, and always save the entire solution to a
problem in a script or function m-file.
</p>

<p>
So, here is list of useful tips.
</p>

<ul class="org-ul">
<li>Save all your Matlab files in a dedicated folder on your network
drive or memory stick. Change the <i>current working directory</i> to
this folder using the <code>cd</code> command or the user interface.
Alternatively, you can add a folder to the <i>Matlab path</i> using
<code>addpath</code>. Do not save files on the C-drive or D-drive in the
computer lab rooms; you will lose your work.</li>

<li>Write a separate script or function m-file for each exercise.  Make
sure to start your script with the <code>clear</code> statement to make sure
that the script starts in an empty workspace, unless your "logic"
depends on repeating the same script more than once&#x2014;usually it
should not.</li>

<li>Try to prevent hard coding and use variables to capture problem
data&#x2014;initialize these variables at the start of the script.
Writing functions instead of scripts will allow you to modify
problem data in a more flexible way.</li>

<li>If you write a function, then it might be a good idea to write an
accompanying script file testing the function, or calling the
function in such a way that it produces the results you want.</li>

<li>If you came up with clever idea, and want to be sure that you still
recall how it works tomorrow, then add comments to your code.</li>
</ul>

<p>
Later, in <a href="#org2a2e65b">this</a> section you will get some more information about
structuring and documenting your code.
</p>
</div>
</div>
</div>

<div id="outline-container-orgcaaa480" class="outline-2">
<h2 id="orgcaaa480"><span class="section-number-2">2</span> Quick refresher</h2>
<div class="outline-text-2" id="text-2">
<p>
This section is a contains a quick refresher of some basic Matlab
stuff. Hopefully, you'll have little problems understanding everything
here. Most material is presented by examples.
</p>
</div>

<div id="outline-container-orge5233fb" class="outline-3">
<h3 id="orge5233fb"><span class="section-number-3">2.1</span> Simple creation of arrays:</h3>
<div class="outline-text-3" id="text-2-1">
<p>
Rows are separated by semicolons, and columns by commas.
</p>
<pre class="example" id="org9f992e0">
&gt;&gt; A = [1, 2, 3; 4, 5, 6; 7, 8, 9]

A =

     1     2     3
     4     5     6
     7     8     9

&gt;&gt; b = [0; 1; 0]

b =

     0
     1
     0
</pre>
</div>
</div>

<div id="outline-container-org106b74f" class="outline-3">
<h3 id="org106b74f"><span class="section-number-3">2.2</span> Information about sizes and dimensions:</h3>
<div class="outline-text-3" id="text-2-2">
<pre class="example" id="org35c26cc">
&gt;&gt; size(A)

ans =

     3     3

&gt;&gt; ndims(A)

ans =

     2

&gt;&gt; size(b)

ans =

     3     1

&gt;&gt; length(b)

ans =

     3

&gt;&gt; ndims(b)

ans =

     2
</pre>
</div>
</div>

<div id="outline-container-orge372ce4" class="outline-3">
<h3 id="orge372ce4"><span class="section-number-3">2.3</span> Combine variables with right dimensions:</h3>
<div class="outline-text-3" id="text-2-3">
<pre class="example" id="org7b5f563">
&gt;&gt; [A, b]

ans =

     1     2     3     0
     4     5     6     1
     7     8     9     0

&gt;&gt; [A; b]
Error using vertcat
Dimensions of matrices being concatenated are not consistent.
</pre>
</div>
</div>

<div id="outline-container-org3948c4a" class="outline-3">
<h3 id="org3948c4a"><span class="section-number-3">2.4</span> Delete rows/columns</h3>
<div class="outline-text-3" id="text-2-4">
<pre class="example" id="org93ac093">
&gt;&gt; A

A =

     1     4     7
     2     5     8
     3     6     9

&gt;&gt; A(2,:) = []   % delete second row of A

A =

     1     4     7
     3     6     9
</pre>
<p>
Alternatively, you can also redefine \(A\): <code>A = A([1, 3],:)</code> (only keep
rows 1 and 3).
</p>
</div>
</div>

<div id="outline-container-org7882fa8" class="outline-3">
<h3 id="org7882fa8"><span class="section-number-3">2.5</span> Implicit expansion and compatible sizes</h3>
<div class="outline-text-3" id="text-2-5">
<p>
In older version of Matlab you could add a scalar (1x1) to a vector or
a matrix, but for other sizes you had to make sure that the dimensions
of the operands match exactly. For example, if you want to add a
vector to all columns of a matrix, you first had to create copies of
the vector to match the number of columns of the matrix and then add
the results.
</p>
<pre class="example" id="org2822d71">
&gt;&gt; A = reshape(1:9, 3, 3)

A =

     1     4     7
     2     5     8
     3     6     9

&gt;&gt; v = [10; 20; 30]

v =

    10
    20
    30

&gt;&gt; A + repmat(v, 1, 3)

ans =

    11    14    17
    22    25    28
    33    36    39
</pre>
<p>
Note that this is a bit inconvenient, but usually this is still faster
than doing a for-loop.
</p>

<p>
Fortunately, recent versions of Matlab use <i>implicit expansion</i> of
compatible sizes. We can now just do the following:
</p>
<pre class="example" id="org4e8e8cf">
&gt;&gt; A + v

ans =

    11    14    17
    22    25    28
    33    36    39
</pre>
<p>
Matlab sees that the number of rows in \(A\) and \(v\) are the same, and
expands \(v\) to match the size of matrix \(A\). We can also use this to
easily create special matrices:
</p>
<pre class="example" id="orgc0cec90">
&gt;&gt; [1, 2, 3] + [10; 20; 30]  % add row and column vector

ans =

    11    12    13
    21    22    23
    31    32    33
</pre>
</div>
</div>

<div id="outline-container-org4b042b2" class="outline-3">
<h3 id="org4b042b2"><span class="section-number-3">2.6</span> Colon operator:</h3>
<div class="outline-text-3" id="text-2-6">
<pre class="example" id="orgeb85215">
&gt;&gt; 0:8

ans =

     0     1     2     3     4     5     6     7     8

&gt;&gt; 0:2:10

ans =

     0     2     4     6     8    10

&gt;&gt; -2:0.5:2

ans =

   -2.0000   -1.5000   -1.0000   -0.5000         0    0.5000    1.0000    1.5000    2.0000
</pre>
</div>
</div>

<div id="outline-container-org6ed710a" class="outline-3">
<h3 id="org6ed710a"><span class="section-number-3">2.7</span> Referencing elements:</h3>
<div class="outline-text-3" id="text-2-7">
<p>
Note that <code>end</code> can be used to refer to the last element of a certain
dimension.
</p>
<pre class="example" id="org1da53e4">
&gt;&gt; A(2,3)

ans =

     6

&gt;&gt; b(2)

ans =

     1

&gt;&gt; b([1 3])

ans =

     0
     0

&gt;&gt; A(1:2, [1 3])    % submatrix

ans =

     1     3
     4     6

&gt;&gt; A(1,2:end)

ans =

     2     3

&gt;&gt; A(:, 2)    % select all (rows)

ans =

     2
     5
     8

&gt;&gt; A(end,:)   % last row of A

ans =

     3     6     9

&gt;&gt; b(:, [1 1 1 1])   % replicate 1st column 4 times

ans =

     0     0     0     0
     1     1     1     1
     0     0     0     0
</pre>
</div>
</div>

<div id="outline-container-orgd881df7" class="outline-3">
<h3 id="orgd881df7"><span class="section-number-3">2.8</span> Matrix operations</h3>
<div class="outline-text-3" id="text-2-8">
<pre class="example" id="org9447989">
&gt;&gt; A + A

ans =

     2     4     6
     8    10    12
    14    16    18

&gt;&gt; 3*A - 10

ans =

    -7    -4    -1
     2     5     8
    11    14    17

&gt;&gt; A*b  % matrix-vector product

ans =

     2
     5
     8

&gt;&gt; A'       % transpose

ans =

     1     4     7
     2     5     8
     3     6     9
</pre>
</div>
</div>

<div id="outline-container-orgc3e58bb" class="outline-3">
<h3 id="orgc3e58bb"><span class="section-number-3">2.9</span> Element-wise operations</h3>
<div class="outline-text-3" id="text-2-9">
<p>
These are a great tool to prevent the use of loops.
</p>
<pre class="example" id="org6db3253">
&gt;&gt; 1./A

ans =

    1.0000    0.5000    0.3333
    0.2500    0.2000    0.1667
    0.1429    0.1250    0.1111

&gt;&gt; A.^2

ans =

     1     4     9
    16    25    36
    49    64    81

&gt;&gt; A.*A

ans =

     1     4     9
    16    25    36
    49    64    81
</pre>
</div>
</div>

<div id="outline-container-org55f416d" class="outline-3">
<h3 id="org55f416d"><span class="section-number-3">2.10</span> Logical operations</h3>
<div class="outline-text-3" id="text-2-10">
<pre class="example" id="org2366f3c">
&gt;&gt; x = 1:10

x =

     1     2     3     4     5     6     7     8     9    10

&gt;&gt; x &gt; 5

ans =

  1x10 logical array

   0   0   0   0   0   1   1   1   1   1

&gt;&gt; x &gt; 2 &amp; x &lt; 7   % logical AND

ans =

  1x10 logical array

   0   0   1   1   1   1   0   0   0   0

&gt;&gt; x &gt;= 2 &amp; x &lt;= 7

ans =

  1x10 logical array

   0   1   1   1   1   1   1   0   0   0

&gt;&gt; x &lt;= 2 | x &gt;= 8   % logical OR

ans =

  1x10 logical array

   1   1   0   0   0   0   0   1   1   1

&gt;&gt; ~ans      % logical NOT

ans =

  1x10 logical array

   0   0   1   1   1   1   1   0   0   0
</pre>

<p>
Short-circuit tests (<code>&amp;&amp;</code> and =||+) prevent the evaluation of the
second part if the value of the first already determines the outcome:
</p>
<pre class="example" id="org920a893">
&gt;&gt; x = 1:2

x =

     1     2

&gt;&gt; (length(x) &gt; 2) &amp; (x(3) &gt; 0)
Index exceeds matrix dimensions.
 
&gt;&gt; (length(x) &gt; 2) &amp;&amp; (x(3) &gt; 0)

ans =

  logical

   0
</pre>
</div>
</div>

<div id="outline-container-org3584a38" class="outline-3">
<h3 id="org3584a38"><span class="section-number-3">2.11</span> If/else</h3>
<div class="outline-text-3" id="text-2-11">
<div class="org-src-container">
<pre class="src src-matlab"><span style="color: #859900;">if</span> x < 0 <span style="color: #b58900;">|</span> x > 100
    disp(&#8217;x is negative or larger than 100&#8217;)
<span style="color: #859900;">elseif</span> x <span style="color: #b58900;">==</span> round(x)
    disp(&#8217;x is an integer in the range [0,100]&#8217;)
<span style="color: #859900;">else</span>
    disp(&#8217;x is a non-integer in the range [0,100]&#8217;)
<span style="color: #859900;">end</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org7c38b7a" class="outline-3">
<h3 id="org7c38b7a"><span class="section-number-3">2.12</span> For loop</h3>
<div class="outline-text-3" id="text-2-12">
<div class="org-src-container">
<pre class="src src-matlab"><span style="color: #586e75;">% Compute Fibonacci numbers</span>
f = [1, 1];
<span style="color: #859900;">for</span> <span style="color: #268bd2;">n</span> = <span style="color: #268bd2; font-weight: bold;">3:10</span>
    f(n) = f(n<span style="color: #b58900;">-</span>1) <span style="color: #b58900;">+</span> f(n<span style="color: #b58900;">-</span>2);
<span style="color: #859900;">end</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org106827d" class="outline-3">
<h3 id="org106827d"><span class="section-number-3">2.13</span> While loop</h3>
<div class="outline-text-3" id="text-2-13">
<div class="org-src-container">
<pre class="src src-matlab">n = 0;
x = 2^(55);
<span style="color: #586e75;">% Divide x by 2 as long as it remains greater than 1, but do the division at most 50 times.</span>
<span style="color: #859900;">while</span> x <span style="color: #b58900;">&gt;</span> 1
    x = x<span style="color: #b58900;">/</span>2;
    n = n<span style="color: #b58900;">+</span>1;
    <span style="color: #859900;">if</span> n <span style="color: #b58900;">&gt;</span> 50
    	<span style="color: #859900;">break</span> <span style="color: #586e75;">% break out of loop</span>
    <span style="color: #859900;">end</span>       
<span style="color: #859900;">end</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orge13ac5e" class="outline-3">
<h3 id="orge13ac5e"><span class="section-number-3">2.14</span> Script and function m-files</h3>
<div class="outline-text-3" id="text-2-14">
<p>
A script file is simply a collection of matlab statements. By calling
the script Matlab executes the statements as if you would have typed
them on the command line.  Suppose we save the following code in a
file called <code>script1.m</code>.
</p>
<div class="org-src-container">
<pre class="src src-matlab"><span style="color: #586e75;">% It is often a good idea to start your script with a CLEAR statement,</span>
<span style="color: #586e75;">% which clears the workspace.</span>
clear

<span style="color: #586e75;">% Initialize parameters</span>
n = 10000;
m = [10; 50; 100; 500; 1000; 5000; 10000];

<span style="color: #586e75;">% Put random number generator in default state for reproducibility</span>
rng(<span style="color: #2aa198;">'default'</span>)

<span style="color: #586e75;">% Get random sample of standard normal distribution</span>
x = randn(n, 1);

<span style="color: #859900;">for</span> <span style="color: #268bd2; font-weight: bold;">i</span> = <span style="color: #268bd2; font-weight: bold;">1:length(m)</span>

    <span style="color: #586e75;">% Calculate 95% confidence interval for certain sample size</span>
    y = x(1<span style="color: #b58900;">:</span>m(<span style="color: #268bd2; font-weight: bold;">i</span>));
    mu = mean(y);
    sigma = std(y);
    ci = mu <span style="color: #b58900;">+</span> norminv(0.975) <span style="color: #b58900;">*</span> sigma <span style="color: #b58900;">/</span> sqrt(m(<span style="color: #268bd2; font-weight: bold;">i</span>)) <span style="color: #b58900;">*</span> [<span style="color: #b58900;">-</span>1, 1];

    <span style="color: #586e75;">% Print result</span>
    fprintf(<span style="color: #2aa198;">'n = %5d: [%8.4f, %8.4f]\n'</span>, m(<span style="color: #268bd2; font-weight: bold;">i</span>), ci);

<span style="color: #859900;">end</span>
</pre>
</div>
<p>
Now we can call this script from the command line.
</p>
<pre class="example" id="org744263d">
&gt;&gt; script1
n =    10: [ -0.4727,   1.7212]
n =    50: [ -0.0659,   0.6340]
n =   100: [ -0.1047,   0.3509]
n =   500: [ -0.1099,   0.0661]
n =  1000: [ -0.0945,   0.0293]
n =  5000: [ -0.0075,   0.0477]
n = 10000: [ -0.0178,   0.0211]
</pre>

<p>
On the other hand, a function m-file has input and output arguments
and has a <i>local workspace</i>. Any arguments or other variables created
while the function executes are available only within the function.
Conversely, the variables available to the command line (the so-called
base workspace) are normally not visible to the function.
</p>
<div class="org-src-container">
<pre class="src src-matlab"><span style="color: #859900;">function</span> <span style="color: #268bd2;">[x1, x2]</span> = <span style="color: #268bd2;">quadform</span>(<span style="color: #268bd2;">a</span>, <span style="color: #268bd2;">b</span>, <span style="color: #268bd2;">c</span>)
<span style="color: #586e75;">%QUADFORM Return two zeros of quadratic form a*x^2 + b*x + c</span>
<span style="color: #586e75;">%</span>
<span style="color: #586e75;">% [x1, x2] = quadform(a, b, c)</span>

d = sqrt(b<span style="color: #b58900;">^</span>2 <span style="color: #b58900;">-</span> 4<span style="color: #b58900;">*</span>a<span style="color: #b58900;">*</span>c);
x1 = (<span style="color: #b58900;">-</span>b <span style="color: #b58900;">+</span> d) <span style="color: #b58900;">/</span> (2<span style="color: #b58900;">*</span>a);
x2 = (<span style="color: #b58900;">-</span>b <span style="color: #b58900;">-</span> d) <span style="color: #b58900;">/</span> (2<span style="color: #b58900;">*</span>a);
</pre>
</div>
<p>
Functions can be called from the command line or from within other
functions.
</p>
<pre class="example" id="orge32a717">
&gt;&gt; [r1, r2] = quadform(1, -3, 2)

r1 =

     2


r2 =

     1
</pre>
</div>
</div>
</div>

<div id="outline-container-org4dbbbb6" class="outline-2">
<h2 id="org4dbbbb6"><span class="section-number-2">3</span> Efficient coding</h2>
<div class="outline-text-2" id="text-3">
</div>

<div id="outline-container-org170c57a" class="outline-3">
<h3 id="org170c57a"><span class="section-number-3">3.1</span> Introduction</h3>
<div class="outline-text-3" id="text-3-1">
<p>
One of the most important things that I want you to take away from
this course is that you'll produce efficient Matlab code.  By this I
mean that I don't want to see code for which there is an obvious
better solution.  Compared to many other programming languages (such
as C++, Java, Delphi, etc.) Matlab often requires a different way of
thinking.  Many complex tasks can be performed in a few lines of code
where other languages need many more.  Besides being shorter, usually
this concise solution performs much faster than the alternative
solution, which can used in Matlab as well.
</p>

<p>
Let's give an example.  Suppose that we have a matrix <code>A</code>, say <code>A =
rand(10000,1000)</code>, and we want to divide all numbers larger than 0.5
by 2.  The straightforward approach, used in many other programming
languages, would be the following:
</p>
<div class="org-src-container">
<pre class="src src-matlab">[m, n] = size(A);
<span style="color: #859900;">for</span> <span style="color: #268bd2; font-weight: bold;">i</span>=<span style="color: #268bd2; font-weight: bold;">1:m</span>
  <span style="color: #859900;">for</span> <span style="color: #268bd2; font-weight: bold;">j</span>=<span style="color: #268bd2; font-weight: bold;">1:n</span>
    <span style="color: #859900;">if</span> A(<span style="color: #268bd2; font-weight: bold;">i</span>, <span style="color: #268bd2; font-weight: bold;">j</span>)<span style="color: #b58900;">&gt;</span>0.5
      A(<span style="color: #268bd2; font-weight: bold;">i</span>, <span style="color: #268bd2; font-weight: bold;">j</span>) = A(<span style="color: #268bd2; font-weight: bold;">i</span>, <span style="color: #268bd2; font-weight: bold;">j</span>)<span style="color: #b58900;">/</span>2;
    <span style="color: #859900;">end</span>
  <span style="color: #859900;">end</span>
<span style="color: #859900;">end</span>
</pre>
</div>
<p>
This solution gets the job done, and if you are not really interested
in the performance of this piece of code (because you don't have to
perform it many times and/or for large matrices), then there is not
much of a problem.  However, you don't always know under what
circumstances your code will be used in the future.  Therefore, it
would be nice if you pick up the habit of automatically coding such
as problem as follows:
</p>
<div class="org-src-container">
<pre class="src src-matlab"><span style="color: #268bd2; font-weight: bold;">i</span> = A<span style="color: #b58900;">&gt;</span>0.5;
A(<span style="color: #268bd2; font-weight: bold;">i</span>) = A(<span style="color: #268bd2; font-weight: bold;">i</span>)<span style="color: #b58900;">/</span>2;
</pre>
</div>
<p>
This solution doesn't only perform much faster in Matlab, it has the
additional advantage that it also works for numerical arrays with
dimensions unequal to two.
</p>

<p>
The continuous awareness that you should try to develop is "<i>How can I
 prevent the use of loops?</i>"
</p>

<p>
In this block, we will look at tools and techniques that you can use to
make your Matlab code more efficient and in particular to prevent
loops.
</p>
</div>
</div>

<div id="outline-container-org493d6d2" class="outline-3">
<h3 id="org493d6d2"><span class="section-number-3">3.2</span> Preallocation</h3>
<div class="outline-text-3" id="text-3-2">
<p>
If you are going to use loops anyway, then make sure that you
preallocate memory for output arrays.  Adding new elements/rows
etc. to an existing array is <i>very</i> time consuming.
</p>
<p>
In the code below, we use the <code>tic/toc</code> commands to time how long it takes to perform the piece of code in encapsulates.
</p>

<div class="org-src-container">
<pre class="src src-matlab">N = 1e6;

<span style="color: #859900;">tic</span>                             <span style="color: #586e75;">% start stopwatch</span>
x = 0;
<span style="color: #859900;">for</span> <span style="color: #268bd2;">k</span> = <span style="color: #268bd2; font-weight: bold;">2:N</span>
   x(k) = x(k<span style="color: #b58900;">-</span>1) <span style="color: #b58900;">+</span> 5;           <span style="color: #586e75;">% expand the existing array</span>
<span style="color: #859900;">end</span>
bad = <span style="color: #859900;">toc</span>

<span style="color: #859900;">tic</span>
y = zeros(1, N);                <span style="color: #586e75;">% preallocate the output</span>
<span style="color: #859900;">for</span> <span style="color: #268bd2;">k</span> = <span style="color: #268bd2; font-weight: bold;">2:N</span>
   y(k) = y(k<span style="color: #b58900;">-</span>1) <span style="color: #b58900;">+</span> 5;
<span style="color: #859900;">end</span>
good = <span style="color: #859900;">toc</span>
</pre>
</div>
<p>
Output
</p>
<div class="org-src-container">
<pre class="src src-fundamental">bad =

    0.2769


good =

    0.0174
</pre>
</div>
</div>
</div>

<div id="outline-container-org115115a" class="outline-3">
<h3 id="org115115a"><span class="section-number-3">3.3</span> Element-wise Arithmetic</h3>
<div class="outline-text-3" id="text-3-3">
<p>
Try to operate on multi-dimensional arrays as much as possible.  Basic
mathematical functions such as <code>sin</code>, <code>exp</code>, <code>log</code> can be applied to
multi-dimensional arrays.  A bit less familiar, but a great tool to
get rid of loops, are the basic arithmetic operators <code>.*</code>, <code>./</code>, <code>.^</code>,
that operate on arrays of the same dimension (or scalars).  For
instance:
</p>
<div class="org-src-container">
<pre class="src src-matlab">A = A<span style="color: #b58900;">./</span>B;
B = B<span style="color: #b58900;">.^</span>2;
</pre>
</div>
<p>
to divide every element in the matrix <code>A</code> by the corresponding element
in <code>B</code> and square the elements in the matrix <code>B</code>.  Note that the
latter is different from <code>B^2</code>, which is the <i>matrix product</i> of <code>B</code>
with itself. <b> Experiment with this yourself in Matlab. </b>
</p>
</div>
</div>

<div id="outline-container-org9144651" class="outline-3">
<h3 id="org9144651"><span class="section-number-3">3.4</span> Useful functions</h3>
<div class="outline-text-3" id="text-3-4">
<p>
There is quite a number of built-in functions that prevent the usage
of loops.  Here is a list with a short description and/or example.
Probably, you already know some of these commands.  Make sure that you
are also familiar with the optional extra input and output arguments,
which can often be very useful.
</p>

<dl class="org-dl">
<dt>sum, prod</dt><dd><code>sum(A,2)</code> sums along the second dimension, i.e., over the
columns (to give you the row-sum), of the matrix <code>A</code>. Similarly, <code>prod(A,2)</code> multiplies all entries along the second dimension, i.e., over the
columns (to give you the row-product), of the matrix <code>A</code>. As an example for <code>sum()</code>:</dd>
</dl>
<div class="org-src-container">
<pre class="src src-matlab">A = reshape(1<span style="color: #b58900;">:</span>24, 4, 6)
a1 = sum(A, 1) <span style="color: #586e75;">% Compute columns sums, i.e., sum along <u>first</u> dimension</span>
a2 = sum(A, 2) <span style="color: #586e75;">% Compute rows sums, i.e., sum along <u>second</u> dimension</span>
a3 = sum(A(:)) <span style="color: #586e75;">% Gives sum of <u>all</u> elements in A. Alternatively, use sum(A,'all').	</span>
</pre>
</div>
<p>
With output
</p>
<pre class="example" id="orgc875322">
A =

     1     5     9    13    17    21
     2     6    10    14    18    22
     3     7    11    15    19    23
     4     8    12    16    20    24


a1 =

    10    26    42    58    74    90


a2 =

    66
    72
    78
    84

a3 = 

    300
</pre>
<p>
If you do not specify a dimension in <code>sum()</code> or <code>prod()</code>, then by default Matlab takes the first dimension.
</p>

<dl class="org-dl">
<dt>mean, std, var</dt><dd>calculate the mean along a particular dimension of
an array.  For the <code>std</code> and <code>var</code> functions, the
third input argument refers to the dimension&#x2014;and
the second denotes whether you want the population
(1) or sample (0/default) standard deviation or
variance. See the <a href="https://nl.mathworks.com/help/matlab/ref/std.html" target=_blank>documention</a> for details.</dd>

<dt>min, max</dt><dd>Compute the min/max along a particular dimension (third
input argument).  Indices of min/max-locations are
returned in the second output argument.</dd>
</dl>
<div class="org-src-container">
<pre class="src src-matlab">A = rand(4, 6)
[m1, i1] = min(A, [], 1)
[m2, i2] = min(A, [], 2)
</pre>
</div>
<p>
Output:
</p>
<pre class="example" id="org0fd5555">
A =

    0.0540    0.1299    0.3371    0.5285    0.6541    0.0838
    0.5308    0.5688    0.1622    0.1656    0.6892    0.2290
    0.7792    0.4694    0.7943    0.6020    0.7482    0.9133
    0.9340    0.0119    0.3112    0.2630    0.4505    0.1524


m1 =

    0.0540    0.0119    0.1622    0.1656    0.4505    0.0838


i1 =

     1     4     2     2     4     1


m2 =

    0.0540
    0.1622
    0.4694
    0.0119


i2 =

     1
     3
     2
     2
</pre>

<dl class="org-dl">
<dt>sort</dt><dd>similar to min/max, but dimension is the second input argument</dd>

<dt>cumsum, cumprod</dt><dd>cumulative sum (resp. product)</dd>

<dt>find</dt><dd>returns the indices of nonzero elements.  Useful in
combination with logical tests, e.g., <code>i = find(A&gt;1 &amp; A&lt;2)</code>. More attention to this function is given in sections 3.5 and 3.6 below.</dd>

<dt>all, any</dt><dd>Generalization of logical <i>and</i> and logical <i>or</i>. Tests
whether all entries (any entry) in a particular
dimension of an array are (is) nonzero.</dd>
</dl>
<div class="org-src-container">
<pre class="src src-matlab">A = [1 1 1
     0 1 0
     0 0 0];
rows = [all(A); any(A)]
cols = [all(A,2), any(A,2)]
</pre>
</div>
<p>
Output
</p>
<pre class="example" id="orge442636">
rows =

     0     0     0
     1     1     1


cols =

     1     1
     0     1
     0     0
</pre>

<dl class="org-dl">
<dt>diff</dt><dd>calculate the difference of the elements of an array.  For
instance, <code>diff([1 2 5 8 15])</code> yields <code>[1 3 3 7]</code>.  The
(optional) second and third input arguments can be used to
control the order of the difference and the dimension that
should be used.  A not so obvious practice of the <code>diff</code>
function, but very useful, is locating the positions in a
vector where the value changes.</dd>
</dl>
<div class="org-src-container">
<pre class="src src-matlab">x = [10 10 10 20 20 20 20 30 30 40 40 40]
d = diff(x)
<span style="color: #268bd2; font-weight: bold;">i</span> = [find(d), length(x)]        <span style="color: #586e75;">% always include the last entry</span>
y = x(<span style="color: #268bd2; font-weight: bold;">i</span>)
</pre>
</div>
<dl>
<dt></dt><dd>
Here we use that <code>find(y)</code> returns (as a default) all indices of nonzero elements in <code>y</code> if no other condition is given.
</dd>
</dl>

<p>
Output:
</p>
<pre class="example" id="orgf30472f">
d =

     0     0    10     0     0     0    10     0    10     0     0


i =

     3     7     9    12


y =

    10    20    30    40
</pre>
</div>
</div>

<div id="outline-container-org5fdc3d1" class="outline-3">
<h3 id="org5fdc3d1"><span class="section-number-3">3.5</span> Logical indexing</h3>
<div class="outline-text-3" id="text-3-5">
<p>
In the introductory <a href="#org170c57a">example</a>, we have already seen the use of <b>logical
indexing</b>. The statement <code>i = A&gt;0.5</code> returns a logical (0/1 or
false/true) array of the same dimension as <code>A</code> indicating whether or
not the entry is larger than 0.5. Next, <code>A(i)</code> simply returns those
entries. If necessary, <code>find(i)</code> can be used the get the corresponding
(linear) indices (see <a href="#org07f4981">Linear indexing</a>), but often this is not needed.
</p>

<p>
See <a href="https://youtu.be/JE7I4Krj1PU">here</a> tutorial about logical indexing.
</p>

<iframe width="560" height="315" src="https://www.youtube.com/embed/JE7I4Krj1PU" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
</div>
</div>

<div id="outline-container-org07f4981" class="outline-3">
<h3 id="org07f4981"><span class="section-number-3">3.6</span> Linear indexing</h3>
<div class="outline-text-3" id="text-3-6">
<p>
Internally, Matlab stores a numerical array, regardless of its
dimension and size, as a 1-dimensional vector.  Hence, the 3x4 matrix
in the following example is actually stored as a vector of size 12.
This explains the results of the following Matlab statements.
</p>
<div class="org-src-container">
<pre class="src src-matlab">A = [11 12 13 14
     21 22 23 24
     31 32 33 34]

<span style="color: #268bd2; font-weight: bold;">i</span> = find(mod(A,11) <span style="color: #b58900;">==</span> 0)        <span style="color: #586e75;">% find indices of multiples of 11</span>
x = A(<span style="color: #268bd2; font-weight: bold;">i</span>)
</pre>
</div>
<p>
Output:
</p>
<div class="org-src-container">
<pre class="src src-fundamental">A =

    11    12    13    14
    21    22    23    24
    31    32    33    34


i =

     1
     5
     9


x =

    11
    22
    33
</pre>
</div>

<p>
The vector <code>i</code> is a linear index into the matrix <code>A</code>. In this example,
<code>A(5)</code> is exactly the same thing as <code>A(2,2)</code>. Linear indices can be
translated in the corresponding regular multi-dimensional indices and
vice versa by the functions <code>ind2sub</code> and <code>sub2ind</code>, respectively. See
the Matlab help function for more details of these functions. For
example:
</p>
<pre class="example" id="org21a8bbd">
<span style="color: #586e75;">% First argument of ind2sub is a vector with the matrix dimensions.</span>
<span style="color: #586e75;">% Second argument contains linear indices (entered as row or column vector).</span>
&gt;&gt; [row, col] = ind2sub([3, 4], i') 

row =

     1     2     3


col =

     1     2     3

<span style="color: #586e75;">% row and col together give the matrix indices (1,1), (2,2) and (3,3).</span>
</pre>
</div>
</div>

<div id="outline-container-org81062fc" class="outline-3">
<h3 id="org81062fc"><span class="section-number-3">3.7</span> Matrix creation and transformation</h3>
<div class="outline-text-3" id="text-3-7">
<p>
You should already be aware of functions like <code>ones</code>, <code>zeros</code>, <code>eyes</code>,
<code>diag</code>, <code>tril</code>, <code>triu</code> to create basic arrays of desired size. <b>Have a look at their documentation otherwise.</b> By
adding functions as <code>repmat</code>, <code>reshape</code> and <code>permute</code> a whole new
window of opportunities opens.
</p>
</div>

<div id="outline-container-orgd354761" class="outline-4">
<h4 id="orgd354761"><span class="section-number-4">3.7.1</span> Example: juggling with matrices</h4>
<div class="outline-text-4" id="text-3-7-1">
<p>
Suppose we want to create the matrix
</p>
<pre class="example" id="orgd9682f9">
A =

     1     2
     1     2
     1     2
     3     4
     3     4
     3     4
     5     6
     5     6
     5     6
</pre>
<p>
We can see there is a clear structure: it's a 3-by-2 block matrix with
as the blocks 3-by-1 vectors with the numbers 1 to 6.  Let's try to
create this matrix using the matrix creation and transformation
function Matlab offers.
</p>

<p>
Let's first solve an easier problem.  Suppose the blocks are simply
scalars.  Then the matrix can be obtained by using <code>reshape</code>.
</p>
<pre class="example" id="org68c9ff5">
&gt;&gt; reshape(1:6, 2, 3)'

ans =

     1     2
     3     4
     5     6
</pre>
<p>
Note that we first reshape to a \(2 \times 3\) matrix and then transpose
afterward. You can see why if you try to reshape to a \(3 \times 2\)
matrix straight away.
</p>
<pre class="example" id="orgfd4bb7a">
&gt;&gt; reshape(1:6, 3, 2)

ans =

     1     4
     2     5
     3     6
</pre>
<p>
The numbers 1 to 6 are in the wrong order now, because Matlab fills
the entries by linear indexing, i.e., along the first dimension first.
</p>

<p>
Now back to the original problem. We try the previous approach on
3-by-1 blocks. First, we create the matrix
</p>
<pre class="example" id="org6fde77a">
&gt;&gt; A = repmat(1:6, 3, 1)

A =

     1     2     3     4     5     6
     1     2     3     4     5     6
     1     2     3     4     5     6
</pre>
<p>
Note that we cannot simply reshape to a \(9 \times 2\) or a transposed \(2
\times 9\) matrix as you can see below.
</p>
<pre class="example" id="orgc3ac547">
&gt;&gt; reshape(A, [9, 2])

ans =

     1     4
     1     4
     1     4
     2     5
     2     5
     2     5
     3     6
     3     6
     3     6

&gt;&gt; reshape(A, [2, 9])'

ans =

     1     1
     1     2
     2     2
     3     3
     3     4
     4     4
     5     5
     5     6
     6     6
</pre>
<p>
Again the reason is that Matlab creates the matrices using the linear
index. The solution is to temporarily add a third dimension.
</p>
<pre class="example" id="org2619736">
&gt;&gt; B = reshape(A, [3, 2, 3])

B(:,:,1) =

     1     2
     1     2
     1     2


B(:,:,2) =

     3     4
     3     4
     3     4


B(:,:,3) =

     5     6
     5     6
     5     6
</pre>
<p>
The result is a \(3 \times 2 \times 3\) double array. You can interpret
this as a cube with three layers of \(3 \times 2\) matrices. Note that
reshaping an array does not change the linear indices, i.e., <code>A(i)</code> is
identical to <code>B(i)</code> for any scalar index \(i\). If we want Matlab to
move the block of 3s after the 1s (replacing the 2s), then we need to
permute the array. Permuting an array is nothing more than swapping
indices. Transposing a matrix is an example of an permutation:
\((X^T)_{ij} = X_{ji}\): the first and second dimension of the
transposed matrix correspond, respectively, to the second and first
dimension of the original matrix. We define an array <code>C</code> by swapping
the 2nd and 3rd dimension of the array <code>B</code> above: \(C_{ijl} = B_{ilj}\).
</p>
<pre class="example" id="org3c8d484">
&gt;&gt; C = permute(B, [1, 3, 2])

C(:,:,1) =

     1     3     5
     1     3     5
     1     3     5


C(:,:,2) =

     2     4     6
     2     4     6
     2     4     6
</pre>
<p>
This results in a \(3 \times 3 \times 2\) array. Now the linear index is
exactly lined up the way we want: if we reshape back to 2 dimensions
this array, we get our desired result.
</p>
<pre class="example" id="org3658b40">
&gt;&gt; D = reshape(C, [9, 2])

D =

     1     2
     1     2
     1     2
     3     4
     3     4
     3     4
     5     6
     5     6
     5     6
</pre>
</div>
</div>
</div>

<div id="outline-container-orgf0e653e" class="outline-3">
<h3 id="orgf0e653e"><span class="section-number-3">3.8</span> Profiling</h3>
<div class="outline-text-3" id="text-3-8">
<p>
If you are really interested in optimizing your code, then Matlab's
<a href="http://www.mathworks.nl/help/matlab/matlab_prog/profiling-for-improving-performance.html">profiler</a> is a very useful tool.  It presents you an overview of how
many times a specific function or line of code was executed and how
many time was spent there.  This gives you a good indication where you
should try to improve your code.  The profiler can easily be activated
from the Matlab Editor interface using the button <i>Run and Time</i>.
</p>

<p>
See <a href="https://youtu.be/dXo191HvvY0">Profiling tutorial</a>. You can stop watching when he starts talking
about using parallel processing using multiple cores simultaneously
(<code>parpool</code> and <code>parfor</code>) at about 4:30. You do not need to know this.
</p>

<iframe width="560" height="315" src="https://www.youtube.com/embed/dXo191HvvY0" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
</div>
</div>

<div id="outline-container-orgf663e6f" class="outline-3">
<h3 id="orgf663e6f"><span class="section-number-3">3.9</span> Debugging</h3>
<div class="outline-text-3" id="text-3-9">
<p>
More important than the efficiency of your code is of course that the
code does what it should do.  If it doesn't, then you should
debug your code.  You can do this by looking at your code and try to
spot the bug, but sometimes it is more convenient to use Matlab's
<a href="http://www.mathworks.nl/help/matlab/matlab_prog/debugging-process-and-features.html">debugging</a> tools.  In that way you can go over the execution of your
code step by step.  Often that can give you ideas about improving the
efficiency of your code as well.
</p>

<p>
The debugger can also be easily accessed from the Matlab Editor
interface.  You can set a breakpoint on any line in your code by
pressing F12.  If you run the code, the execution halts at this line.
After that you get the option to execute the code line by line, either
bypassing function calls or diving into the function calls on a
particular line.
</p>

<p>
See <a href="https://youtu.be/PdNY9n8lV1Y">Debugging tutorial</a>.
</p>

<iframe width="560" height="315" src="https://www.youtube.com/embed/PdNY9n8lV1Y" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
</div>
</div>

<div id="outline-container-org57bdcc3" class="outline-3">
<h3 id="org57bdcc3"><span class="section-number-3">3.10</span> Final remarks</h3>
<div class="outline-text-3" id="text-3-10">
<p>
The tools we have discussed in this block enable a Matlab programmer
to write very powerful programs with a few lines of code.  The danger
exists that this code becomes difficult to read, even to the
programmer himself.  Therefore, it is the programmer's responsibility
to add appropriate comments to the code if necessary.
</p>

<p>
It's up to you to find the right balance between producing <i>efficient
code</i> on the one hand, and having an <i>efficient coding process</i> on the
other hand.  It doesn't make sense to spend one hour optimizing your
code, if you're applying it only once on a small or medium sized data
set.  However, it would be nice if you are able to optimize your code
if necessary.  If you try to change your way of thinking is this
respect, it often goes automatically in practice.  Hence, <i>avoid
loops</i> as much as you can <i>anywhere</i> during this course (and forever
after!).  During the exam, some of your abilities in this respect will
be tested!
</p>

<p>
Very useful functions to prevent the use of loops, but outside the
scope of our course, are <code>arrayfun</code>, <code>cellfun</code>.  If you
really need to address speed issues of your Matlab code, then have a
look at these functions.  See the Matlab help and <a href="http://ubcmatlabguide.github.io/html/speedup.html#29">Yagtom</a>.
</p>
</div>
</div>

<div id="outline-container-org248a5c8" class="outline-3">
<h3 id="org248a5c8"><span class="section-number-3">3.11</span> Exercises</h3>
<div class="outline-text-3" id="text-3-11">
</div>
<div id="outline-container-orgf144adc" class="outline-4">
<h4 id="orgf144adc"><span class="section-number-4">3.11.1</span> Student grades</h4>
<div class="outline-text-4" id="text-3-11-1">
<p>
Define a three-dimensional array using the statements
</p>
<div class="org-src-container">
<pre class="src src-matlab">n = [4, 2, 10]
A = 10 <span style="color: #b58900;">*</span> rand(n)
</pre>
</div>
<p>
Perform the following tasks <i>without using loops</i>.
</p>
<ol class="org-ol">
<li>Suppose that the entries in the matrix represent grades. Round the
grades to halves. The only exception is that the grade 5.5 is not
allowed; these grades have to be rounded to 5 or 6. <i>Hint:</i> use a
logical index to locate the grades between 5 and 6. Then perform
the one rounding operation on these grades, and another rounding
operation on the grades not between 5 and 6.</li>

<li>Create a matrix B with three columns for which the rows represent
the indices into the matrix A that correspond to sufficient grades
(&gt;=6). Hence, if <code>A(2,1,5)</code> is greater or equal to 6, then <code>[2, 1,
   5]</code> is one of the rows of <code>B</code>. Use <code>ind2sub</code>.</li>

<li>The matrix contains the grades for 10 students who each did 2
assignments of 4 questions each.  Calculate the students' overall
grades, which is determined by the arithmetic mean of the in total
8 questions.  Did you use the <code>mean</code> function once or twice?  Try
using it only once. (<i>Hint:</i> use <code>reshape</code>.)</li>
</ol>
</div>
</div>

<div id="outline-container-org56324c3" class="outline-4">
<h4 id="org56324c3"><span class="section-number-4">3.11.2</span> Euclidean distance</h4>
<div class="outline-text-4" id="text-3-11-2">
<p>
Let the rows of the \(m \times n\) matrix \(X\) represent \(m\) vectors in
\(n\)-dimensional space.  We want to create a \(m \times m\) matrix \(D\)
such that \(D_{ij}=\|x_i-x_j\|_2\), i.e., the Euclidean distance
(2-norm) between the ith and jth row of \(X\).  We want to write a
function for this purpose.
</p>

<ol class="org-ol">
<li>Implement the "standard" approach using two loops to generate all
combinations of vectors \(i\) and \(j\).</li>

<li>The final step is to make an even more efficient implementation by
using only a single loop. Pick a vector \(i\) and calculate its
distance to all the other vectors \(j\; (j>i)\). Finally, note that
the distance matrix is symmetric.</li>

<li>Write a script file that tests the performance of your two
implementations on a random matrix of size \(1000 \times 10\).  Use
<code>tic</code> and <code>toc</code> to time the methods.</li>
</ol>
</div>
</div>

<div id="outline-container-orgdd28a07" class="outline-4">
<h4 id="orgdd28a07"><span class="section-number-4">3.11.3</span> Find the bug</h4>
<div class="outline-text-4" id="text-3-11-3">
<p>
In this exercise you'll have to find an error in a function.  It is
not a syntax error, but a logical error, which might lead to errors or
simply returns an unintended answer.  If you can't find such an error
right away, then a good alternative is to use the Debugger.  Walk
through the function step by step and examine intermediate output.
</p>

<p>
Save the file <a href="rebalance.m">rebalance.m</a> on your Matlab path.  This function is
supposed to convert a time series, represented by a vector, such that
it does no longer contains negative entries.  It does so by transfering
negative entries backwards in time, such that the sum of entries does
not change (unless there is a negative entry in period 1).  In case there is a negative entry in period 1, 
it is replaced by zero (i.e., the negative entry is pushed towards the imaginary period 0 if you will). For
instance, if \(x=(4,-2,1)\), then the negative entry in period two can
be combined with the 4 in the first period.  This yields the corrected
series \(\tilde{x}=(2,0,1)\).  If the function works correctly, it
should give the output shown in the example below.
</p>

<pre class="example" id="org095220f">
&gt;&gt; y = rebalance([2, 4, -2, 3, 2, -4, 5])

y =

     2     2     0     1     0     0     5

&gt;&gt; y = rebalance([2, 4, -2, 3, 2, -4, -1])

y =

     2     2     0     0     0     0     0

&gt;&gt; y = rebalance([-2, 4, -2, 3, 2, -4, 5])

y =

     0     2     0     1     0     0     5
</pre>

<p>
Unfortunately, the function does not always return the correct output
(see the second and third examples above).  Find and correct the
bug(s)!
</p>
</div>
</div>

<div id="outline-container-org29948ac" class="outline-4">
<h4 id="org29948ac"><span class="section-number-4">3.11.4</span> Square form</h4>
<div class="outline-text-4" id="text-3-11-4">
<p>
Consider the square form \(x^TAx\) with \(x \in \mathbb{R}^n\) and \(A\in \mathbb{R}^{n
\times n}\).  Suppose that we want to evaluate this expression for all
vectors in the rows of the \(m \times n\) matrix \(X\).
The standard solution with loops is as follows:
</p>
<div class="org-src-container">
<pre class="src src-matlab">[m,n] = size(X);
y = zeros(m,1);
<span style="color: #859900;">for</span> <span style="color: #268bd2; font-weight: bold;">i</span>=<span style="color: #268bd2; font-weight: bold;">1:m</span>
  y(<span style="color: #268bd2; font-weight: bold;">i</span>) = X(<span style="color: #268bd2; font-weight: bold;">i</span>,<span style="color: #b58900;">:</span>) <span style="color: #b58900;">*</span> A <span style="color: #b58900;">*</span> X(<span style="color: #268bd2; font-weight: bold;">i</span>,<span style="color: #b58900;">:</span>)<span style="color: #b58900;">'</span>;
<span style="color: #859900;">end</span>
</pre>
</div>
<ol class="org-ol">
<li>Can you find a method that does not require a loop?  <i>Hint:</i> look
for a combination of a (regular) matrix product and a
elementwise-product of matrices.</li>
<li>Generate random matrices \(X\) and \(A\) for \(n=40\), \(m=1000\).  Test
the performance of the two approaches by replicating the
computations, say 1000 times, by putting them in a loop and time
the duration using <code>tic</code> and <code>toc</code>.</li>
<li>Also compare the performance of the two methods using the <a href="#orgf0e653e">profiler</a>.</li>
</ol>
</div>
</div>

<div id="outline-container-orgb3a7e1d" class="outline-4">
<h4 id="orgb3a7e1d"><span class="section-number-4">3.11.5</span> Run length decoding</h4>
<div class="outline-text-4" id="text-3-11-5">
<p>
Reconsider the <a href="#org9144651">example</a> about the <code>diff</code> function. Extend the use of
the <code>diff</code> function even further by writing a function that also
counts the number of subsequent equal values. For a given input vector
<code>x</code>, the function should return two outputs: a vector <code>y</code> (as in the
example) and a vector <code>c</code> that counts the number of subsequential
values in <code>x</code>. For the particular example this would be <code>y = [10 20 30
40]</code> and <code>c = [3 4 2 3]</code>, i.e., 3 times the value 10, 4 times the
value 20, etc.
</p>
</div>
</div>
</div>
</div>

<div id="outline-container-org0c28213" class="outline-2">
<h2 id="org0c28213"><span class="section-number-2">4</span> Cells, structures, and other data types</h2>
<div class="outline-text-2" id="text-4">
<p>
See a short introduction to <a href="https://youtu.be/ZK0ig6NozqU">Structures and Cell Arrays</a>.
</p>

<iframe width="560" height="315" src="https://www.youtube.com/embed/ZK0ig6NozqU" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
</div>

<div id="outline-container-orgc7a317e" class="outline-3">
<h3 id="orgc7a317e"><span class="section-number-3">4.1</span> Cells</h3>
<div class="outline-text-3" id="text-4-1">
<p>
The most used data type in Matlab is without any doubt the <i>double</i>,
which is a data type that represents numerical numbers.
Multi-dimensional arrays allow us to represent vectors, matrices and
even higher dimensional data.  Regardless of the dimension and size of
such an array, each and every entry in such an array is always a <i>single</i>
double.  Cell arrays are similar in most aspects, but each entry of a
cell array can be any other Matlab data type, e.g., a matrix, a
string, a double, a structure array or even another cell array.  This
is especially convenient if you want to store data that somehow
belongs together and has different formats and sizes.
</p>

<p>
Look at <a href="http://ubcmatlabguide.github.io/html/dataStructures.html#13">this</a> quick introduction about cell arrays.  You can stop
reading when they start talking about <code>cellfun</code>.  Although this is a
very useful function, especially in combination with <a href="#orgb11b171">function handles</a>,
and I encourage the use of it, we don't deal with it in this course.
</p>

<p>
If you need more information about cell arrays look at the Matlab
documentation on the web <a href="http://www.mathworks.nl/help/matlab/cell-arrays.html">here</a>, or even better, access the Matlab help
function.
</p>
</div>
</div>

<div id="outline-container-org8938f92" class="outline-3">
<h3 id="org8938f92"><span class="section-number-3">4.2</span> Structures</h3>
<div class="outline-text-3" id="text-4-2">
<p>
Structures arrays are an alternative way to store data of different
types and size in a single entity.  You might know structures from
other programming languages, such as Java and c++, and they are very
similar in Matlab, however, we don't consider objects as in object
oriented programming, just regular Matlab data types.
</p>

<p>
Read the introduction about structures, and structure arrays, on
<a href="http://ubcmatlabguide.github.io/html/dataStructures.html#59">Yagtom</a>.  For more detailed information, again look at the official
Matlab documentation.
</p>
</div>

<div id="outline-container-org16f613f" class="outline-4">
<h4 id="org16f613f"><span class="section-number-4">4.2.1</span> Example: passing multiple arguments to a function</h4>
<div class="outline-text-4" id="text-4-2-1">
<p>
One of the nice possibilities of structs is to pass multiple input
arguments to a function.  This is specially useful for large projects.
</p>

<p>
Suppose that you have a set of functions that share a large set of
parameters:
</p>
<div class="org-src-container">
<pre class="src src-matlab"><span style="color: #859900;">function</span> <span style="color: #268bd2;">y</span> = <span style="color: #268bd2;">main</span>(<span style="color: #268bd2;">x</span>,<span style="color: #268bd2;">rho</span>,<span style="color: #268bd2;">lambda</span>,<span style="color: #268bd2;">mu</span>,<span style="color: #268bd2;">sigma</span>,<span style="color: #268bd2;">A</span>,<span style="color: #268bd2;">b</span>)

y = subfun(x,rho,lambda,mu,sigma,A,b);
</pre>
</div>
<div class="org-src-container">
<pre class="src src-matlab"><span style="color: #859900;">function</span> <span style="color: #268bd2;">y</span> = <span style="color: #268bd2;">subfun</span>(<span style="color: #268bd2;">x</span>,<span style="color: #268bd2;">rho</span>,<span style="color: #268bd2;">lambda</span>,<span style="color: #268bd2;">mu</span>,<span style="color: #268bd2;">sigma</span>,<span style="color: #268bd2;">A</span>,<span style="color: #268bd2;">b</span>)

y = x <span style="color: #b58900;">+</span> rho<span style="color: #b58900;">/</span>lambda <span style="color: #b58900;">+</span> mu<span style="color: #b58900;">*</span>sigma <span style="color: #b58900;">+</span> A<span style="color: #b58900;">'*</span>A<span style="color: #b58900;">*</span>b;
</pre>
</div>

<p>
Now suppose that somewhere in the code you call the function by
<code>main(x,mu,sigma,rho,lambda,A,b)</code>.  This doesn't give you an error
message, but the result is probably not as intended and it will be
difficult to spot this bug.
</p>

<p>
Moreover, suppose that we need to extend the computation in <code>subfun</code>
and that an additional input argument is needed.  Then, we'll need to
change the function <code>main</code> and all functions that call <code>main</code> and
<code>subfun</code> as well.
</p>

<p>
We can resolve these inconveniences by using structs:
</p>
<div class="org-src-container">
<pre class="src src-matlab"><span style="color: #859900;">function</span> <span style="color: #268bd2;">y</span> = <span style="color: #268bd2;">main</span>(<span style="color: #268bd2;">x</span>, <span style="color: #268bd2;">pars</span>)

y = subfun(x, pars);
</pre>
</div>
<div class="org-src-container">
<pre class="src src-matlab"><span style="color: #859900;">function</span> <span style="color: #268bd2;">y</span> = <span style="color: #268bd2;">subfun</span>(<span style="color: #268bd2;">x</span>, <span style="color: #268bd2;">pars</span>)

<span style="color: #586e75;">% Extract parameters from struct.  This step is not really necessary,</span>
<span style="color: #586e75;">% because we can use the values directly as well.</span>
rho    = pars.rho;
lambda = pars.lambda;
mu     = pars.mu;
sigma  = pars.sigma;
A      = pars.A;
b      = pars.b;

y = x <span style="color: #b58900;">+</span> rho<span style="color: #b58900;">/</span>lambda <span style="color: #b58900;">+</span> mu<span style="color: #b58900;">*</span>sigma <span style="color: #b58900;">+</span> A<span style="color: #b58900;">'*</span>A<span style="color: #b58900;">*</span>b;
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orga442920" class="outline-3">
<h3 id="orga442920"><span class="section-number-3">4.3</span> Other data types</h3>
<div class="outline-text-3" id="text-4-3">
<p>
In this section, we will shortly highlight some of Matlab's other data
types that might prove useful some day.
</p>
</div>

<div id="outline-container-org5513b1b" class="outline-4">
<h4 id="org5513b1b"><span class="section-number-4">4.3.1</span> Dates and time</h4>
<div class="outline-text-4" id="text-4-3-1">
<p>
Matlab has a <a href="https://nl.mathworks.com/help/matlab/date-and-time-operations.html">datetime</a> data type, which can be used to store dates
and times. This data type can conveniently be created with the
<code>datetime</code> function. The <i>datetime</i> data type is useful, because it
allows straightforward computation for intervals, durations,
conversion from and to various string formats, working with time
zones, and access of properties such as day, week number, etc.
</p>
</div>
</div>

<div id="outline-container-orgc046107" class="outline-4">
<h4 id="orgc046107"><span class="section-number-4">4.3.2</span> Character and strings arrays</h4>
<div class="outline-text-4" id="text-4-3-2">
<p>
Text in Matlab can be represented in both <a href="https://nl.mathworks.com/help/matlab/characters-and-strings.html">character and string</a> arrays.
Traditionally, text is represented by <i>character</i> arrays in Matlab,
which is simply a sequence of characters. In Matlab, you can represent
character arrays using <i>single</i> quote characters:
</p>
<pre class="example" id="orgc980824">
&gt;&gt; name = 'Ruud'

name =

    'Ruud'

&gt;&gt; name(2:3)

ans =

    'uu'
</pre>
<p>
If you want to store multiple character arrays you should do so in a
cell array:
</p>
<pre class="example" id="org176453b">
&gt;&gt; names = {'Ruud', 'Peter'}

names =

    {'Ruud'}    {'Peter'}
</pre>
<p>
A disadvantage of character arrays is that you cannot easily do simple
tests such as checking whether two character arrays are identical.
</p>
<pre class="example" id="org3e8a75f">
&gt;&gt; names{1} == names{2}
Matrix dimensions must agree.

&gt;&gt; names{1} == names{2}(1:4)

ans =

  14 logical array

   0   0   0   0
</pre>
<p>
Instead you can use <code>strcmp</code> or other functions for these purposes.
</p>

<p>
Alternatively, you can also represent text in <i>string</i> arrays by using
the double quote character. String arrays can also contain multiple
strings.
</p>
<pre class="example" id="org7d64742">
&gt;&gt; names = ["Ruud", "Peter"; "Angelique", "Anne"]

names = 

    "Ruud"         "Peter"
    "Angelique"    "Anne" 
</pre>
<p>
Testing and sorting with strings is much easier than with character
arrays. For example:
</p>
<pre class="example" id="org960944f">

&gt;&gt; names(1) == names(2)

ans =

  logical

   0

&gt;&gt; sort(names(:))

ans = 

    "Angelique"
    "Anne"
    "Peter"
    "Ruud"
</pre>
</div>
</div>

<div id="outline-container-org606427c" class="outline-4">
<h4 id="org606427c"><span class="section-number-4">4.3.3</span> Tables</h4>
<div class="outline-text-4" id="text-4-3-3">
<p>
The <a href="https://nl.mathworks.com/help/matlab/tables.html">table</a> data type is very suitable for storing column-oriented or
tabular data. This data type is similar to the <i>data frame</i> in the <a href="https://www.r-project.org/">R
programming language</a> and to the <a href="https://pandas.pydata.org/">pandas</a> DataFrame in Python. This data
types allows easy access to data by using column names and row labels,
and has many other features.
</p>
</div>
</div>
</div>

<div id="outline-container-orgb6cb0ff" class="outline-3">
<h3 id="orgb6cb0ff"><span class="section-number-3">4.4</span> Exercises</h3>
<div class="outline-text-3" id="text-4-4">
</div>
<div id="outline-container-org951e59c" class="outline-4">
<h4 id="org951e59c"><span class="section-number-4">4.4.1</span> Reading from a text file</h4>
<div class="outline-text-4" id="text-4-4-1">
<p>
In this exercise we are also going to practice some data import and
export tools.  Note that if you are importing/exporting only numerical
data, then <code>dlmread</code> and <code>dlmwrite</code> are convenient functions.  Here we
have mixed numerical and text data, which is a bit more complicated.
</p>

<ol class="org-ol">
<li>Download the file <a href="datelist.csv">datelist.csv</a> and have a look at it.</li>

<li>Import the data in Matlab using the <i>Import Data</i> button from the
<i>Home</i> tab. Change the default settings to import the data in
<i>vectors</i> . Import the "Month" and "Weekday" fields as <i>Text</i>
rather than <i>Categorical</i>. The other fields should be imported as
numerical data. If you really get stuck here, then download the
Matlab data file <a href="datelist.mat">datelist.mat</a> and load it in your Matlab session.</li>

<li>Create a 9x2 cell array <code>C</code>. For every year (there are 9 different
years) in the data set put the year number (i.e., a scalar value)
in the first "column". You can get the list of unique year numbers
in the data by using the <code>unique</code> function. The second "column"
should be filled by two-column matrices containing the day and week
numbers of the corresponding year in the data set.</li>

<li>Create a 12x1 structure array (one for each month; use <code>unique</code>
again) with the fields: month, day, weekday and year. Of course,
the month field only needs to contain a single string (character
array). The other fields should contain, for every date within the given month, 
the respective days, weekdays and years (respectively).
You might need to search for a built-in Matlab function
that you can use to compare character arrays and cells.</li>

<li>Check if there are any duplicate dates in the data set. Note that
the original data is already in ascending order, and that the
combination of the triplet (year, day, week) completele determines a date
(i.e., the month and weekday of a date can be determined uniquely based
on the triplet),
 so you don't need to consider any of the text data. Try
not to use a loop for locating the duplicates.</li>

<li>Write the duplicate dates to a comma-separated-values (CSV) file
with a structure exactly similar to the original.  Also include
the header line.  Take a look at the functions <code>fopen</code>, <code>fprintf</code>
and <code>fclose</code>.</li>
</ol>
</div>
</div>

<div id="outline-container-org05f94dd" class="outline-4">
<h4 id="org05f94dd"><span class="section-number-4">4.4.2</span> Combinations totaling to sum</h4>
<div class="outline-text-4" id="text-4-4-2">
<p>
Consider natural numbers \(n\) and \(k\).  We are interested in creating
all possible combinations of \(k\) numbers summing to \(n\).  For example,
if \(n=4\) and \(k=3\), then these combinations are
</p>
<pre class="example" id="orgd2f0ebd">
0     0     4
0     1     3
0     2     2
0     3     1
0     4     0
1     0     3
1     1     2
1     2     1
1     3     0
2     0     2
2     1     1
2     2     0
3     0     1
3     1     0
4     0     0
</pre>
<p>
For fixed \(k\) a straightforward solution comes to mind involving \(k\)
loops.  The problem, however, is that \(k\) and hence the number of
loops is unknown beforehand.  This problem could be solved by
recursion, but still that solution uses a lot of loops.
</p>

<p>
A very elegant solution to this problem, which illustrates the
possibilities to do things without loops, is given by the following
function.  It is instructive to walk through the steps of this
function using the debugger.
</p>
<div class="org-src-container">
<pre class="src src-matlab"><span style="color: #859900;">function</span> <span style="color: #268bd2;">c</span> = <span style="color: #268bd2;">combsum</span>(<span style="color: #268bd2;">n</span>,<span style="color: #268bd2;">k</span>)
<span style="color: #586e75;">% </span><span style="color: #268bd2; font-weight: bold;">COMBSUM </span><span style="color: #586e75;">All combinations of natural numbers totaling to sum</span>
<span style="color: #586e75;">%</span>
<span style="color: #586e75;">% c = combsum(n,k)</span>
<span style="color: #586e75;">%</span>
<span style="color: #586e75;">% Returns all possible combinations of K numbers totalling to N in the</span>
<span style="color: #586e75;">% rows of the output matrix C.</span>

<span style="color: #586e75;">% We consider n+k-1 items: n ones and k-1 "dividers".  The dividers partition</span>
<span style="color: #586e75;">% the n numbers in k subsets.</span>
<span style="color: #586e75;">% </span>
<span style="color: #586e75;">% Suppose n=4, k=3.  Then one of the combinations produced by nchoosek is</span>
<span style="color: #586e75;">% [2 5].  This places dividers at position 2 and 5:</span>
<span style="color: #586e75;">%</span>
<span style="color: #586e75;">%   [ 1 2 3 4 5 6</span>
<span style="color: #586e75;">%     1 * 1 1 * 1 ]</span>
<span style="color: #586e75;">%</span>
<span style="color: #586e75;">% which partitions the ones in three parts yielding the combination [1 2 1].</span>
<span style="color: #586e75;">%</span>
<span style="color: #586e75;">% This combination can be obtained taking the diff of [0 [2 5] 7] and</span>
<span style="color: #586e75;">% subtracting one.</span>

dividers = nchoosek(1<span style="color: #b58900;">:</span>(n<span style="color: #b58900;">+</span>k<span style="color: #b58900;">-</span>1), k<span style="color: #b58900;">-</span>1);    <span style="color: #586e75;">% produce all combinations</span>
nDividers = size(dividers, 1);

<span style="color: #586e75;">% Add dividers at the beginning and end.</span>
b = [zeros(nDividers, 1), dividers, (n<span style="color: #b58900;">+</span>k)<span style="color: #b58900;">*</span>ones(nDividers, 1)];

<span style="color: #586e75;">% Find distances between dividers.</span>
c = diff(b, 1, 2) <span style="color: #b58900;">-</span> 1;
</pre>
</div>

<p>
In this exercise, we make another implementation of the function
<code>combsum</code> by using cell arrays. First, we'll explain the function
<code>ndgrid</code>, which can be used to create rectangular grids in
n-dimensional space. Here is an example with two dimensions.
</p>
<pre class="example" id="orga4651ee">
&gt;&gt; [X, Y] = ndgrid(1:2:9, 2:2:14)

X =

     1     1     1     1     1     1     1
     3     3     3     3     3     3     3
     5     5     5     5     5     5     5
     7     7     7     7     7     7     7
     9     9     9     9     9     9     9


Y =

     2     4     6     8    10    12    14
     2     4     6     8    10    12    14
     2     4     6     8    10    12    14
     2     4     6     8    10    12    14
     2     4     6     8    10    12    14
</pre>
<p>
We see that the size of both outputs are 2-dimensional. The first
output replicates the first input argument in the second dimension,
and the second output replicates the second input argument in the
first dimension. If we would lay both outputs on top of each other,
then you see that  you obtain all possible combinations that can be
obtained from the two input vectors. This idea can be generalized to
multiple dimension. If there is only one input argument, then this is
input vector is used for all dimensions. This is illustrated in the
next example.
</p>
<pre class="example" id="orgbd37778">
&gt;&gt; [x, y, z] = ndgrid(1:3)

x(:,:,1) =

     1     1     1
     2     2     2
     3     3     3


x(:,:,2) =

     1     1     1
     2     2     2
     3     3     3


x(:,:,3) =

     1     1     1
     2     2     2
     3     3     3


y(:,:,1) =

     1     2     3
     1     2     3
     1     2     3


y(:,:,2) =

     1     2     3
     1     2     3
     1     2     3


y(:,:,3) =

     1     2     3
     1     2     3
     1     2     3


z(:,:,1) =

     1     1     1
     1     1     1
     1     1     1


z(:,:,2) =

     2     2     2
     2     2     2
     2     2     2


z(:,:,3) =

     3     3     3
     3     3     3
     3     3     3
</pre>
<p>
Now we can start solving the exercise using <code>ndgrid</code>. In the exercise,
we are dealing with an unspecified number of \(k\) dimensions.
Therefore, it is unclear how we should catch the output of our call to
the <code>ndgrid</code> function. We can use the following trick, involving cell
arrays.
</p>

<ol class="org-ol">
<li>Initialize an empty cell array <code>x</code> of size \(1 \times k\).</li>
<li>Use the <code>ndgrid</code> function to create \(k\) multi-dimensional arrays of
size \((n+1)^{k}\) (with values from the vector <code>0:n</code>) into the cell
array that you just created. The left-hand side of this assignment
should be <code>[x{:}]</code>, which is the same as <code>[x{1},x{2},...,x{end}]</code>.
This puts the \(k\) outputs of <code>ndgrid</code> in the \(k\) cells of cell
array <code>x</code>.</li>
<li>Inspect the output for small values of \(n\) and \(k\). We need to
reshape the contents of each cell to a vector and put them in a
matrix <code>A</code> with \(k\) columns (you may use a loop for this). This
matrix <code>A</code> contains all possible combinations of \(k\) numbers with
values from \(0\) to \(n\).</li>
<li>If you now delete all rows that do not add up to \(n\), then you are
done.</li>
<li>Test the intermediate steps of the approach with small values for
\(n\) and \(k\), so that you understand what is going on, and finally
write the new implementation of <code>combsum</code>.</li>
</ol>
</div>
</div>
</div>
</div>
<div id="outline-container-orgb11b171" class="outline-2">
<h2 id="orgb11b171"><span class="section-number-2">5</span> Function handles &amp; anonymous functions</h2>
<div class="outline-text-2" id="text-5">
</div>
<div id="outline-container-org292affb" class="outline-3">
<h3 id="org292affb"><span class="section-number-3">5.1</span> Introduction</h3>
<div class="outline-text-3" id="text-5-1">
<p>
You should already be familiar with the concept of m-file functions,
because it's the standard way to define a function in Matlab.  M-file
functions allow you to divide your computations in independent pieces
of code, which can be called whenever you like.  However, it is a bit
annoying when you have to create a m-file function for a one line
function definition.  Sometimes this is necessary though, for example
when you have to define the objective function of an optimization
problem, because the optimization tool requires this as an input.
This is where function handles and anonymous functions are extremely
convenient as we shall see.
</p>

<p>
See tutorial about <a href="https://youtu.be/bBHXJGjphQM">function handles and anonymous functions</a>.
</p>

<iframe width="560" height="315" src="https://www.youtube.com/embed/bBHXJGjphQM" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
</div>
</div>

<div id="outline-container-org82107f3" class="outline-3">
<h3 id="org82107f3"><span class="section-number-3">5.2</span> Function handles</h3>
<div class="outline-text-3" id="text-5-2">
<p>
A function handle is nothing more than a <i>reference</i> to another
function.  This is a simple example how to create and use a reference
to a built-in Matlab function.
</p>
<div class="org-src-container">
<pre class="src src-matlab">f = @sin;                       <span style="color: #586e75;">% reference to the sin function</span>
x = f(<span style="color: #268bd2; font-weight: bold;">pi</span><span style="color: #b58900;">*</span>(0<span style="color: #b58900;">:</span>0.5<span style="color: #b58900;">:</span>2))             <span style="color: #586e75;">% evaluate sin through the function handle f</span>
</pre>
</div>
<div class="org-src-container">
<pre class="src src-fundamental">x =

         0    1.0000    0.0000   -1.0000   -0.0000
</pre>
</div>

<p>
This also works for multiple input and output arguments.
</p>
<div class="org-src-container">
<pre class="src src-matlab">g = @min;
A = [1 2
     4 3];
[x,<span style="color: #268bd2; font-weight: bold;">i</span>] = g(A,[],2)               <span style="color: #586e75;">% find row minimum (traverse along 2nd dimension)</span>
</pre>
</div>
<div class="org-src-container">
<pre class="src src-fundamental">x =

     1
     3


i =

     1
     2
</pre>
</div>
</div>
</div>

<div id="outline-container-org7caf192" class="outline-3">
<h3 id="org7caf192"><span class="section-number-3">5.3</span> Anonymous functions</h3>
<div class="outline-text-3" id="text-5-3">
<p>
An <a href="http://www.mathworks.nl/help/matlab/matlab_prog/anonymous-functions.html">anonymous function</a> is a special type of function handle to a
function for which no m-file function exists.  You can see it as an
alternative to inline functions.  Actually, anonymous functions are
much more flexible and faster than inline functions, so use anonymous
functions from now on.
</p>

<p>
Here is a simple example of an anonymous function:
</p>
<div class="org-src-container">
<pre class="src src-matlab">f = @(x) poisspdf(x, 5)
</pre>
</div>
<p>
This statement defines a function handle <code>f</code> to a function of one
variable <code>x</code>, which is defined by <code>poisspdf(x, 5)</code>.  Hence, <code>f(2)</code>
would return the same output as <code>poisspdf(2, 5)</code>, which is the
probability that a Poisson distributed random variable with mean 5 is
equal to 2.  Note that the variable <code>x</code>, which is used in the
definition of the anonymous function has no effect on a variable with
the same name in the current workspace.
</p>

<p>
We can also define functions with multiple input arguments and use
variables from the workspace in the definition.
</p>
<div class="org-src-container">
<pre class="src src-matlab">a = 1;
c = 2;
f = @(x, a) a<span style="color: #b58900;">.*</span>(x<span style="color: #b58900;">-</span>c)<span style="color: #b58900;">.^</span>2;
</pre>
</div>
<p>
Note that we are using element-wise arithmetic operators in the
definition.  This allows us to call the function with non-scalar
inputs (as long as they match in size of course).  Another important
thing to remember is that changing the value of <code>c</code> has no effect on
the definition of <code>f</code>: only the value of <code>c</code> at the time of the
definition is relevant!  On the other hand, the value of <code>a</code> in the
workspace has no effect at all on the function <code>f</code> where <code>a</code> is only
used as a (temporary) reference to the second input argument of <code>f</code>.
These notions explain the results of the following commands.
</p>
<div class="org-src-container">
<pre class="src src-matlab">t = [4 4 5 5];
b = [1 2 1 2];
y = f(t, b);
a = 100;
c = 100;
y = [y; f(t, b)]
</pre>
</div>
<p>
Changing the variables <code>a</code> and <code>c</code> has no effect on the output as you
can see:
</p>
<div class="org-src-container">
<pre class="src src-fundamental">y =

     4     8     9    18
     4     8     9    18
</pre>
</div>
</div>
</div>

<div id="outline-container-org41535c2" class="outline-3">
<h3 id="org41535c2"><span class="section-number-3">5.4</span> Illustrative example</h3>
<div class="outline-text-3" id="text-5-4">
<p>
Now that we have seen how to define anonymous functions, let's have a
look at some examples where anonymous functions are very useful.  We
can use them
</p>
<ul class="org-ul">
<li>to pass a function to another function,</li>
<li>to capture data values for later use by a function,</li>
<li>to call functions outside of their normal scope.</li>
</ul>

<p>
A useful Matlab function is the <code>fzero</code> function, which you can use
to find the zero location of a function of a scalar variable.  For
instance:
</p>
<div class="org-src-container">
<pre class="src src-fundamental">&gt;&gt; fzero(@log, 2) <span style="color: #586e75;">       %First argument is the function, second argument an initial guess</span>

ans =

    1
</pre>
</div>
<p>
<code>@log</code> is a function handle of the function for which we want to find
the root and the second argument is an initial guess of the
location of the root.
</p>

<p>
Often, you don't want to find the location where a function is equal
to zero, but the location where it is equal to a certain value <code>c</code>,
which is not necessarily equal to zero.  What to do if we want to find
the location where the gamma function is equal to 10?  Without
anonymous functions, we would have to define an m-file function that,
for a given input <code>x</code>, returns <code>gamma(x) - 10</code>, and use that function as
the input for <code>fzero</code>.  We would have to repeat this procedure for
other targets than <code>10</code>.  Of course, we can easily define a function
with a second input argument that represents the target, but <code>fzero</code>
requires a function with only one input variable.
</p>

<p>
This problem is easily solved with anonymous functions:
</p>
<div class="org-src-container">
<pre class="src src-matlab">f = @(x) gamma(x) <span style="color: #b58900;">-</span> 10;
x = fzero(f, 2)
</pre>
</div>
<p>
We can even do it in one line:
</p>
<div class="org-src-container">
<pre class="src src-matlab">x = fzero(@(x) gamma(x) <span style="color: #b58900;">-</span> 10, 2)
</pre>
</div>

<p>
We can take this idea even one step further by defining a function
that generalizes the <code>fzero</code> function to include an input variable
that represents the target.  Consider the m-file function
</p>
<div class="org-src-container">
<pre class="src src-matlab"><span style="color: #859900;">function</span> <span style="color: #268bd2;">x</span> = <span style="color: #268bd2;">ftarget</span>(<span style="color: #268bd2;">f</span>, <span style="color: #268bd2;">target</span>, <span style="color: #268bd2;">x0</span>)

g = @(x) f(x) <span style="color: #b58900;">-</span> target;
x = fzero(g, x0);
</pre>
</div>
<p>
Now we can do
</p>
<div class="org-src-container">
<pre class="src src-fundamental">&gt;&gt; [ftarget(@log, 1, 2), ftarget(@gamma, 120, 3), ftarget(@normcdf, 0.975, 3)]

ans =

    2.7183    6.0000    1.9600
</pre>
</div>
<p>
Note that we could have obtained the same results from the following
anonymous function instead of the m-file function above.
</p>
<div class="org-src-container">
<pre class="src src-matlab">ftarget = @(fun, target, x0) fzero(@(x) fun(x) <span style="color: #b58900;">-</span> target, x0)
</pre>
</div>
</div>
</div>

<div id="outline-container-orge082da9" class="outline-3">
<h3 id="orge082da9"><span class="section-number-3">5.5</span> Exercises</h3>
<div class="outline-text-3" id="text-5-5">
</div>
<div id="outline-container-org3b9d088" class="outline-4">
<h4 id="org3b9d088"><span class="section-number-4">5.5.1</span> Piecewise function</h4>
<div class="outline-text-4" id="text-5-5-1">
<p>
Define the following function as an anonymous function.  Make sure
that the function allows non-scalar input.  Note that you can't use
<code>if</code> statements or loops in the definition of an anonymous function.
<i>Hint:</i> use a logical index as an <i>indicator</i> function.
</p>
\begin{equation*}
f(x) = \begin{cases}
2x+2 & \mathrm{if\ } x \leq 1\\
x+3 & \mathrm{if\ } 1 < x \leq 2 \\
7-x^2/2 & \mathrm{if\ } x > 2
\end{cases}
\end{equation*}

<p>
Plot the function using <code>fplot</code>.
</p>
</div>
</div>


<div id="outline-container-org5caac24" class="outline-4">
<h4 id="org5caac24"><span class="section-number-4">5.5.2</span> Expected value</h4>
<div class="outline-text-4" id="text-5-5-2">
<p>
Let \(X\), \(Y\) be independent gamma distributed random variables with shape parameter 5
and scale parameter 2.  Write anonymous functions that return 
</p>
<ol class="org-ol">
<li>\(\mathbb{E}[X]\)</li>
<li>\(\text{Var}[X]\)</li>
<li>\(\text{Cov}[X,Y]\)</li>
</ol>
by directly implementing the definitions of these operators (see Wikipedia if you forgot them). 
You will need to use a built-in function to evaluate integrals.<br></br>
</div>
</div>

<!-- Old exercise on expectation
<div id="outline-container-org5caac24" class="outline-4">
<h4 id="org5caac24"><span class="section-number-4">5.5.2</span> Expected value</h4>
<div class="outline-text-4" id="text-5-5-2">
<p>
Let \(X\) be a gamma distributed random variable with shape parameter 5
and scale parameter 2.  Write an anonymous function <code>Efx</code> that returns
\(E[f(X)]\) for a function \(f(.)\).  For instance, \(E[\log(X)]\) can be
calculated by <code>Efx(@log)</code>.  You'll need to find a (built-in) function
you can use to evaluate an integral.  Use your version of <code>Efx</code> to
calculate
</p>
<ol class="org-ol">
<li>\(E[\log(X)]\)</li>
<li>\(E[1/X]\)</li>
<li>\(E[\cos(X)]\)</li>
<li>\(E[(X-10)^2]\) Note that this should return the variance of \(X\): 20.</li>
</ol>
</div>
</div>

-->

<div id="outline-container-org8ced988" class="outline-4">
<h4 id="org8ced988"><span class="section-number-4">5.5.3</span> Solving nonlinear equations</h4>
<div class="outline-text-4" id="text-5-5-3">
<p>
In this exercise we will try to solve a system of <i>nonlinear</i>
equations.  Note that we will discuss <i>linear</i> equations in the
section about <a href="#orgc845b3b">Linear algebra</a>.
</p>

<p>
Make an anonymous function for \(f:\mathbb{R}^n \rightarrow \mathbb{R}^n\) with \(n\) an
even natural number and
</p>
\begin{equation*}
f(x) = \begin{bmatrix} g(x) \\ h(x) \end{bmatrix},
\end{equation*}
<p>
with
</p>
\begin{equation*}
g_i(x) = 1 - x_{2i-1}, \qquad i=1,\dots,n/2
\end{equation*}
<p>
and
</p>
\begin{equation*}
h_i(x) = 10(x_{2i-1}-x_{2i})^2, \qquad i=1,\dots,n/2
\end{equation*}
<p>
Note that it is not too difficult to do this without having to define
the functions \(g(.)\) and \(h(.)\) first.  For instance, the function
\(g(.)\) is easily defined by <code>1-x(1:2:end-1)</code>.  Moreover, you can write
a single anonymous function that works for all (even) \(n\).
</p>

<p>
We are interested in solving the nonlinear system of equations
\(f(x)=0\), which has \(n\) equations and \(n\) unknowns.  It can easily be
verified that the n-dimensional all-one vector is a solution for this
problem.
</p>

<ol class="org-ol">
<li>Now try to find this solution numerically using the <code>fsolve</code>
function. Read the documentation about how to use this function.
Pick a random initial guess&#x2014;i.e., generate it using a random
number generator&#x2014;and make sure to have the function display some
output so that you can check the number of function evaluations
(use <code>optimoptions</code> to set the option 'Display' to
'iter-detailed').</li>

<li>
Write an anonymous function that takes as input an upper bound \(T\) on how many function evaluations
<code>fsolve</code> may use, as well as the initial guess for <code>fsolve</code> to use, and outputs
the solution \(x\) such that \(f(x) = 0\) as computed by <code>fsolve</code>.
</li>

<li><p>
To illustrate that the algorithm is much more efficient if it can
also use the first-order gradient (rather than estimating it), we
repeat the task above by also providing <code>fsolve</code> with the Jacobian
(first derivative) of \(f(.)\). You cannot use an anonymous function
for that. This time you have to write a m-file function to compute
the function \(f\) (first output argument) and its Jacobian (second
output argument). The partial derivatives of
\(f\) are
</p>
\begin{equation*}
  \frac{\partial f_i(x)}{\partial x_j} =
  \begin{cases}
    -1 & \text{for } (i,j) = (k, 2k-1),\; k=1,\dots,n/2\\
    20(x_{2k-1}-x_{2k}) & \text{for } (i,j) = (n/2+k,2k-1),\; k=1,\dots,n/2\\
    -20(x_{2k-1}-x_{2k}) & \text{for } (i,j) = (n/2+k,2k),\; k=1,\dots,n/2\\
    0 & \text{otherwise}
  \end{cases}
\end{equation*}
<p>
The implementation of this Jacobian is a bit tricky, but it's a good exercise to try!
<i>Hint: The first three cases can be implementend by placing the respective Jacobian values on the diagonal
of an appropriately chosen submatrix. First determine the column/row index vectors that form
every submatrix. (There are four vectors that together can be used to construct every submatrix.)</i>
<li>
Run the algorithm again (set the options 'SpecifyObjectiveGradient and 'CheckGradients' to <code>true</code>). You
should see that the number of function evaluations is much smaller than in the case without the Jacobian.
</li>

</p></li>
</ol>
</div>
</div>
</div>
</div>

<div id="outline-container-org2a2e65b" class="outline-2">
<h2 id="org2a2e65b"><span class="section-number-2">6</span> Good coding</h2>
<div class="outline-text-2" id="text-6">
</div>
<div id="outline-container-org38bbbb0" class="outline-3">
<h3 id="org38bbbb0"><span class="section-number-3">6.1</span> Introduction</h3>
<div class="outline-text-3" id="text-6-1">
<p>
More often than not, Matlab is the number one choice among the tools
that I would consider as an alternative to solve a particular problem.
One of the things I like about Matlab is that it is so easy to develop
advanced algorithms in such a short time.  An important reason for
this is the possibility to use the many mathematical, statistical and
visualization functions that are available right out of the box
accompanied with professional documentation and examples.  Another
advantage is the freedom that the language allows.  For instance,
contrary to many other programming languages, in Matlab it is not
necessary to declare variables and their dimension, size and type
before you use them.  As a matter of fact, you can change the
dimension, size and type of a variable at free will.
</p>

<p>
It is easy to understand that the last "advantage" can result in
ambiguities as well.  Combined with the power of this high level
programming language this can introduce serious problems.
Unfortunately, Matlab makes it very easy to make very powerful code
such that even the author cannot understand its meaning after even a
week.  Needless to say that another person cannot make any sense of it
as well. Hence, <i>clean code</i> is usually better than <i>clever code</i>.
</p>

<p>
In this section, we give some guidelines about how we can prevent this
problem and produce "good code".
</p>

<dl class="org-dl">
<dt>No hard coding</dt><dd>Do not mix <i>code</i> and <i>problem data</i>. Simply
replace the problem data in your code by
variables, which can be initialized either as
input arguments of a function, or defined at the
start of a section of code. This will make your
code much easier to maintain.</dd>

<dt>DRY (don't repeat yourself)</dt><dd>One of the fundamentals of good
programming. Once you start to repeat yourself (series of
statements that essentially do the same thing) you should
refactor your code: introduce a loop or write a separate function
for that part of the code.</dd>

<dt>Single responsibility</dt><dd>A function should perform a single
well-defined task. This means that you try to split your problem
in smaller subproblems and write pieces of code for these
subproblems.</dd>

<dt>KISS (keep it stupid simple)</dt><dd>Simplicity above complexity.</dd>

<dt>Good documentation</dt><dd>Add appropriate documentation to your
functions and complex pieces of code.</dd>
</dl>
</div>
</div>

<div id="outline-container-org546940c" class="outline-3">
<h3 id="org546940c"><span class="section-number-3">6.2</span> How to write good code</h3>
<div class="outline-text-3" id="text-6-2">
<p>
As explained in the introduction, the idea of single responsibility is
to split a problem in smaller subproblems. It is hard to give specific
rules here; you will have to find the right balance of the subproblem
size. As a guideline you could say that you should consider writing a
separate Matlab (sub)function if:
</p>
<ul class="org-ul">
<li>You are copying pieces of code (DRY). For instance, if you want to
repeat a certain analysis with minor variations or different data
sets, or if you want to produce the same type of plot for different
data sets.</li>
<li>You are writing a rather complex piece of code of more than, say, 10
lines.</li>
</ul>

<p>
Sometimes you want to repeat pieces of code but with slight
variations. Of course, you do not want to write separate functions for
each of these these variations. Instead you can control the behavior
of the function by allowing different types of input variables (e.g.,
scalar, vectors, and matrices), and by adding optional input
parameters. You can do this in several different ways as illustrated
in the following sections.
</p>
</div>

<div id="outline-container-orgf22e7e7" class="outline-4">
<h4 id="orgf22e7e7"><span class="section-number-4">6.2.1</span> Allowing higher dimensional inputs than necessary for your original problem</h4>
<div class="outline-text-4" id="text-6-2-1">
<p>
Suppose that you want to compute the shape and scale parameters of a
gamma distribution that correspond to a given mean and standard
deviation. Even though it is only two lines of code, this is a typical
example of a well-defined task for which a function can be made.
Perhaps, you need to solve it for a multiple combinations of means and
standard deviations. Hence, it's convenient if the function allows
vector or even higher dimensional input. This can often be
accomplished by making the arithmetic element-wise right from the
start. Even if you cannot prevent the use of loops in the function,
all future caller functions do not have to implement this loop again
and again.
</p>
</div>
</div>

<div id="outline-container-org3364191" class="outline-4">
<h4 id="org3364191"><span class="section-number-4">6.2.2</span> Adding additional input arguments that control the behavior of the function</h4>
<div class="outline-text-4" id="text-6-2-2">
<p>
Suppose that you need to compute the 4-period moving average of
multiple time series with quarterly data.  Because you may need to
repeat this computation several times and for different type of time
series, it makes sense to write a dedicated Matlab function for it.
However, perhaps you need to solve a similar problem in the future
for monthly data.  You can provide an additional input argument that
controls the number of periods for which you want to calculate the
moving average.
</p>
</div>
</div>

<div id="outline-container-orga4670de" class="outline-4">
<h4 id="orga4670de"><span class="section-number-4">6.2.3</span> Providing default values for some input variables</h4>
<div class="outline-text-4" id="text-6-2-3">
<p>
Continuing on the previous example, we can make the additional input
argument optional. Hence, the user is not required to use it, and in
that case the function should provide a default value. This can be
accomplished by the use of the builtin <code>nargin</code> function, which
returns the number of input argument actually provided by the user.
For example:
</p>
<div class="org-src-container">
<pre class="src src-matlab"><span style="color: #859900;">function</span> <span style="color: #268bd2;">y</span> = <span style="color: #268bd2;">MovingAverage</span>(<span style="color: #268bd2;">x</span>, <span style="color: #268bd2;">n</span>)

<span style="color: #859900;">if</span> nargin <span style="color: #b58900;">&lt;</span> 2 <span style="color: #b58900;">||</span> isempty(n)
  <span style="color: #586e75;">% Default: four period moving average</span>
  n = 4;
<span style="color: #859900;">end</span>

<span style="color: #586e75;">% Start of computations</span>
</pre>
</div>
<p>
This allows the user to call the function by <code>MovingAverage(x)</code>,
<code>MovingAverage(x, 4)</code> as well as <code>MovingAverage(x, 12)</code>.
</p>

<p>
By using the <code>varargin</code> construct it is even possible to have a
variable number of input arguments.  The <code>varargin</code> construct requires
some basic knowledge of <a href="#org0c28213">cells</a>.
</p>

<p>
See the Matlab help and <a href="http://ubcmatlabguide.github.io/html/writingFunctions.html#40">Yagtom</a> for some examples.
</p>
</div>
</div>

<div id="outline-container-org3eaa517" class="outline-4">
<h4 id="org3eaa517"><span class="section-number-4">6.2.4</span> Providing additional output</h4>
<div class="outline-text-4" id="text-6-2-4">
<p>
Often your computations produce intermediate or side results. These
results could be useful in some circumstances. Therefore, it doesn't
do any harm to include these results as output variables. Outputs
don't necessarily have to be retrieved by the caller function, hence
if the user doesn't need the results, then there is no waste of
computations or memory. If desired, it is possible to control the flow
inside a function depending on the required output arguments by using
the <code>nargout</code> and possibly even the <code>varargout</code> constructs. In the
section about <a href="#org2e84df8">documentation</a>, you can see an example where <code>nargout</code> is
being used.
</p>
</div>
</div>
</div>

<div id="outline-container-org2e84df8" class="outline-3">
<h3 id="org2e84df8"><span class="section-number-3">6.3</span> Documenting your code</h3>
<div class="outline-text-3" id="text-6-3">
<p>
As noted before, it is important to supply your code with appropriate
documentation.  I distinguish between two different types of
documentation.
</p>
</div>

<div id="outline-container-org8ede617" class="outline-4">
<h4 id="org8ede617"><span class="section-number-4">6.3.1</span> Function documentation</h4>
<div class="outline-text-4" id="text-6-3-1">
<p>
If you write a function, then you should always include
</p>
<ul class="org-ul">
<li>a one-line description of the function</li>
<li>an overview of the input and output variables</li>
<li>a description of what the function does</li>
</ul>

<p>
It is important that all three parts of the function documentation are
put at the top of your file, directly below the function declaration,
in a contiguous block of lines starting with the comment character
(<code>%</code>) and starting with the one-line description.  This entire block
will show up in the Matlab command window when the command <code>help
&lt;FunctionName&gt;</code> is issued.  The first line of the documentation is
displayed for each m-file when the <code>help</code> function is given a
directory name as its argument (<code>help &lt;Directoryname&gt;</code>).
</p>

<p>
The idea is explained in the following example.
</p>

<div class="org-src-container">
<pre class="src src-matlab"><span style="color: #859900;">function</span> <span style="color: #268bd2;">[y, trimmed]</span> = <span style="color: #268bd2;">trim_data</span>(<span style="color: #268bd2;">x</span>, <span style="color: #268bd2;">fraction</span>, <span style="color: #268bd2;">tail</span>)
<span style="color: #586e75;">% TRIM_DATA Trims the tails of input vector</span>
<span style="color: #586e75;">%</span>
<span style="color: #586e75;">% y = trim_data(x)</span>
<span style="color: #586e75;">% y = trim_data(x, fraction)</span>
<span style="color: #586e75;">% y = trim_data(x, fraction, tail)</span>
<span style="color: #586e75;">% [y, trimmed] = trim_data(...)</span>
<span style="color: #586e75;">%</span>
<span style="color: #586e75;">% For a numerical vector, trims away a certain percentage of the lowest</span>
<span style="color: #586e75;">% and/or highest observations.</span>
<span style="color: #586e75;">% </span>
<span style="color: #586e75;">% Input</span>
<span style="color: #586e75;">% -----</span>
<span style="color: #586e75;">%   x: vector with numerical data</span>
<span style="color: #586e75;">%</span>
<span style="color: #586e75;">%   fraction: fraction of observations to trim away (optional, default: 0.2)</span>
<span style="color: #586e75;">%</span>
<span style="color: #586e75;">%   tail: which method to use (optional)</span>
<span style="color: #586e75;">%     0: trim away high and low observations (default)</span>
<span style="color: #586e75;">%     1: trim away high observations only</span>
<span style="color: #586e75;">%     -1: trim away low observations only</span>
<span style="color: #586e75;">%</span>
<span style="color: #586e75;">% Output</span>
<span style="color: #586e75;">% ------</span>
<span style="color: #586e75;">%   y: sorted vector with observations that are not trimmed away</span>
<span style="color: #586e75;">%</span>
<span style="color: #586e75;">%   trimmed: the trimmed observations</span>

<span style="color: #859900;">if</span> nargin <span style="color: #b58900;">&lt;</span> 2 <span style="color: #b58900;">||</span> isempty(fraction)
  <span style="color: #586e75;">% Default trim 20%.</span>
  fraction = 0.2;
<span style="color: #859900;">end</span>

<span style="color: #859900;">if</span> nargin <span style="color: #b58900;">&lt;</span> 3 <span style="color: #b58900;">||</span> isempty(tail)
  <span style="color: #586e75;">% Default trim high and low observations.</span>
  tail = 0;
<span style="color: #859900;">end</span>

<span style="color: #859900;">if</span> tail <span style="color: #b58900;">==</span> 0
  <span style="color: #586e75;">% Convert to one-sided fraction.</span>
  fraction = fraction <span style="color: #b58900;">/</span> 2;
<span style="color: #859900;">end</span>

x = sort(x);
n = length(x);

<span style="color: #586e75;">% Compute the number of observations to trim per tail.</span>
k = floor(fraction <span style="color: #b58900;">*</span> n);

<span style="color: #859900;">switch</span> <span style="color: #268bd2; font-weight: bold;">tail</span>
<span style="color: #859900;">case</span> <span style="color: #268bd2; font-weight: bold;">1</span>
  <span style="color: #586e75;">% Trim high observations.</span>
  y = x(1<span style="color: #b58900;">:</span>end<span style="color: #b58900;">-</span>k);
<span style="color: #859900;">case</span> <span style="color: #268bd2; font-weight: bold;">-1</span>
  <span style="color: #586e75;">% Trim low observations.</span>
  y = x(k<span style="color: #b58900;">+</span>1<span style="color: #b58900;">:</span>end);
<span style="color: #859900;">otherwise</span>
  <span style="color: #586e75;">% Trim high and low observations.</span>
  y = x(k<span style="color: #b58900;">+</span>1<span style="color: #b58900;">:</span>end<span style="color: #b58900;">-</span>k);
<span style="color: #859900;">end</span>

<span style="color: #586e75;">% If second output argument required, then return the trimmed values.</span>
<span style="color: #859900;">if</span> nargout <span style="color: #b58900;">&gt;</span> 1
  <span style="color: #859900;">switch</span> <span style="color: #268bd2; font-weight: bold;">tail</span>
  <span style="color: #859900;">case</span> <span style="color: #268bd2; font-weight: bold;">1</span>
    trimmed = x(end<span style="color: #b58900;">-</span>k<span style="color: #b58900;">+</span>1<span style="color: #b58900;">:</span>end);
  <span style="color: #859900;">case</span> <span style="color: #268bd2; font-weight: bold;">-1</span>
    trimmed = x(1<span style="color: #b58900;">:</span>k);
  <span style="color: #859900;">otherwise</span>
    trimmed = x([1<span style="color: #b58900;">:</span>k, end<span style="color: #b58900;">-</span>k<span style="color: #b58900;">+</span>1<span style="color: #b58900;">:</span>end]);
  <span style="color: #859900;">end</span>
<span style="color: #859900;">end</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgf23c4f2" class="outline-4">
<h4 id="orgf23c4f2"><span class="section-number-4">6.3.2</span> Local documentation</h4>
<div class="outline-text-4" id="text-6-3-2">
<p>
You add local documentation, i.e., documentation to the code itself,
for several reasons.
</p>
<ul class="org-ul">
<li>To enhance the understanding of the main flow of the code.  This is
the type of documentation that is present in the <code>trim_data</code>
function in section about <a href="#org8ede617">Function documentation</a>.</li>
<li>To explain details about nontrivial parts or lines of code</li>
<li>To explain the idea behind variables</li>
</ul>

<p>
It is certainly not necessary, or even desirable, to comment on each
and every line of code.  Note that the necessity of local
documentation diminishes if you write relatively small functions,
because the function already should contain a proper documentation
and the number of different variables is usually limited.
</p>
</div>
</div>

<div id="outline-container-orgdbf7210" class="outline-4">
<h4 id="orgdbf7210"><span class="section-number-4">6.3.3</span> Programming style</h4>
<div class="outline-text-4" id="text-6-3-3">
<p>
Code documentation is supported by a good programming style. The
programming style gives rules/guidelines about e.g.
</p>
<ul class="org-ul">
<li>choosing function/file names,</li>
<li>choosing variables names,</li>
<li>indentation of <code>if</code> statements, <code>for</code> and <code>while</code> loops, and
multi-line statements.</li>
</ul>

<p>
The Matlab editor provides nice support for indentation of code.
Choosing variable/function names is specially important for large
projects and many different styles and preferences exist. I don't want
to add to this discussion.
</p>
</div>
</div>
</div>

<div id="outline-container-orgef5d5aa" class="outline-3">
<h3 id="orgef5d5aa"><span class="section-number-3">6.4</span> Exercise: restructuring code and adding documentation</h3>
<div class="outline-text-3" id="text-6-4">
<p>
In this exercise, we consider a script file that is created by copying
the commands from the <i>Command Window</i> in a Matlab session to an
m-file.  During this Matlab session, I wanted to explore the effect of
rounding errors on the approximation of derivatives by taking <i>finite
differences</i>.  For a function \(f\), the central finite difference
approximation for \(f'(x_0)\) is given by
</p>
\begin{equation*}
  D_h(x_0) = \frac{f(x_0 + h) - f(x_0 - h)}{ 2h },
\end{equation*}
<p>
where \(h\) is the step size.  For relatively large step sizes, this
approximation is inaccurate because it simply does not capture the
curvature at \(x_0\) well enough.  On the other hand, very small step
sizes could introduce <i>numerical inaccuracies</i> due to rounding errors.
</p>

<p>
Have a look at the script file <a href="rounding_error.m">roundingerror.m</a>.  For the \(\sin\)
function and several step sizes I have plotted the errors from the
finite difference approximation at \(x_0=0.5\) and its true derivative,
which we know is the \(\cos\) function.  I also marked the step size
with the smallest error in the plot.  After that, I repeated this
procedure for other values of \(x_0\) and added the results to the same
figure.
</p>

<p>
The example illustrates the ease of experimenting in Matlab.  However,
the resulting script file is not a very generic and flexible piece of
code for several reasons.
</p>

<ul class="org-ul">
<li>If you want to change the values for \(x_0\), then you'll have to
change this at 3 locations in the code.  This is what we call <i>hard
coding</i>.</li>

<li>If you want to add another point \(x_0\), then you'll have to copy a
piece of the code and change the value for \(x_0\) used there.  In
addition, you'll have to come up with a different color code to
distinguish the plot from the other plots in the figure (in the
newer versions of Matlab this is no longer necessary, as Matlab does
this automatically now).</li>

<li>If you want to do the experiment for another function instead of the
sine, then you'll have to change the calls to the sine and cosine
everywhere in the code (hard coding again).</li>
</ul>

<p>
In this exercise, you will try to <i>refactor</i> the script file such that
these drawbacks are resolved.
</p>

<ol class="org-ol">
<li><p>
Write a <i>function</i> m-file with the following input arguments:
</p>
<ul class="org-ul">
<li>reference to a function (a function handle)</li>
<li>reference to a derivative function (also a function handle)</li>
<li>vector with \(x_0\) locations</li>
<li>vector with step sizes</li>
</ul>

<p>
and the following output arguments
</p>
<ul class="org-ul">
<li>matrix with absolute errors corresponding to the \(x_0\) locations
(in the columns) and the step sizes (in the rows)</li>
<li>index locations of step size with minimum error</li>
</ul>

<p>
Make sure that the function has appropriate documention.
</p></li>

<li>Write a new <i>script</i> m-file that uses this function to repeat the
original experiment and plots the results nicely in one figure.</li>
</ol>
</div>
</div>
</div>

<div id="outline-container-orgc845b3b" class="outline-2">
<h2 id="orgc845b3b"><span class="section-number-2">7</span> Linear algebra</h2>
<div class="outline-text-2" id="text-7">
</div>

<div id="outline-container-orgd59507e" class="outline-3">
<h3 id="orgd59507e"><span class="section-number-3">7.1</span> Basic linear algebra in Matlab</h3>
<div class="outline-text-3" id="text-7-1">
<p>
Matlab supports many basic linear algebra operations such as
</p>
<ul class="org-ul">
<li>Creation of special matrices
<ul class="org-ul">
<li><code>eye</code>, <code>zeros</code>, <code>diag</code>, <code>toeplitz</code>, <code>hankel</code>, <code>hilb</code>, <code>vander</code></li>
</ul></li>
<li>Fundamental matrix properties
<ul class="org-ul">
<li><code>det</code>, <code>trace</code>, <code>rank</code>, <code>norm</code>, <code>inv</code></li>
</ul></li>
<li>Matrix factorizations
<ul class="org-ul">
<li><code>eig</code>, <code>qr</code>, <code>lu</code>, <code>svd</code>, <code>chol</code></li>
</ul></li>
</ul>

<p>
Special attention is given to the problem of solving  a system of
linear equations, because in practice people often choose the wrong
alternative to solve this problem.
</p>

<p>
Given \(A \in \mathbb{R}^{m \times n}\) and \(b\in \mathbb{R}^m\), find \(x\in \mathbb{R}^n\) such
that \[ Ax=b. \]
We can distinguish three cases:
</p>
<ol class="org-ol">
<li><b>Square</b> system: \(m=n\)</li>
<li><b>Over-determined</b> system: \(m>n\)</li>
<li><b>Under-determined</b> system: \(m < n\)</li>
</ol>

<p>
A rule of thumb, regardless of the case, is <b>always</b> use the
<b>backslash</b> operator (<code>\</code>, <code>mldivide</code>):
</p>
<div class="org-src-container">
<pre class="src src-matlab">x = A<span style="color: #b58900;">\</span>b;
x = mldivide(A,b);              <span style="color: #586e75;">% same as above</span>
</pre>
</div>
<p>
The computation is <b>more efficient</b> (faster) than alternative
solutions:
</p>
<ol class="org-ol">
<li>Square system (and nonsingular): equivalent to \(x=A^{-1}b\) (<code>x = inv(A)*b</code>)</li>
<li>Over-determined system (\(m>n\)): equivalent to least-squares
solution \(x=(A^{T}A)^{-1}A^{T}b\) (<code>x = inv(A'*A)*A'*b</code>)</li>
<li>Under-determined system (\(m < n\)): <code>A\b</code> gives a solution with as
many zeros as possible.  Alternative solutions can be obtained by
combining this result with the solution(s) to \(Ax=0\), which can be
obtained by <code>null(A)</code>.</li>
</ol>
</div>
</div>

<div id="outline-container-org894528b" class="outline-3">
<h3 id="org894528b"><span class="section-number-3">7.2</span> Exercises</h3>
<div class="outline-text-3" id="text-7-2">
</div>
<div id="outline-container-org8d947f6" class="outline-4">
<h4 id="org8d947f6"><span class="section-number-4">7.2.1</span> Obtaining different solutions to a under-determined linear system</h4>
<div class="outline-text-4" id="text-7-2-1">
<p>
Create a matrix \(A\) and vector \(b\) using the following commands.
</p>
<div class="org-src-container">
<pre class="src src-matlab">m = 6;
n = 10;
A = randn(m,n);
b = randn(m,1);
</pre>
</div>
<p>
Verify that the matrix has rank 6, otherwise repeat the procedure.
Note that the system \(Ax=b\) is under-determined: infinitely many
solutions will exist.  
</p>

<ol class="org-ol">
<li>Obtain an arbitrary particular solution \(\tilde{x}\) for the linear system
\(Ax=b\).</li>

<li><p>
Find the particular solution \(x \in \mathbb{R}^{10}\) for which the
first four elements are equal to zero. 

<!--
Note that if the rank of \(A\)
is 6, then the null space has dimension 4. Hence, any vector \(y\) in
the null space (use <code>null(A)</code>) can be written as a linear
combination of 4 linearly independent vectors \(v^1,\dots,v^4\) in
the null space:
</p>
\begin{equation*}
y = \sum_{i=1}^4 \alpha_i v^i = \begin{bmatrix} v^1 & v^2 & v^3 & v^4 \end{bmatrix} \begin{bmatrix} \alpha_1 \\ \alpha_2 \\ \alpha_3 \\ \alpha_4 \end{bmatrix} = V \alpha.
\end{equation*}
<p>
You'll need to find the coefficients \(\alpha_i\) for which the first
four entries of the vector
</p>
\begin{equation}
x = \tilde{x} + y = \tilde{x} + V \alpha
\end{equation}
<p>
are zero, and you can ignore the other 6 entries of \(x\) and \(y\).
Hence, you'll need to find the homogeneous solution \(y\) for which
\(y_j = (V \alpha)_j = -\tilde{x}_j\), for \(j=1,2,3,4\).
-->
</p></li>
<li>
As a generalization of the previous question, write a function that for \(n - m\) given
indices \(i_1,\dots,i_{n-m}\) returns a solution to \(Ax = b\) for which the variables
\(x_{i_1},\dots,x_{i_{n-m}}\) are zero.
</li>
<li><p>
Recall from your linear algebra course that any
solution to the linear system \(Ax=b\) can be written as \(x = \tilde{x} + y\),
where \(\tilde{x}\) is an arbitrary solution and \(y\) a homogeneous solution,
which is in the null space of \(A\), i.e., \(Ay=0\). We use \(V\) to denote a basis 
of the null space of \(A\), which contains \(n - m\) vectors of length \(n\). <br></br>

We will find the particular solution \(x\) that, among all solutions, has the
smallest 2-norm: \(\lVert x \rVert_2 = \sqrt{x^T x}\).  Ideally, one
would like to choose \(x=0\) because its norm is 0, but \(x=0\) is not
a solution to our linear system.  A solution is always of
the form \(x=\tilde{x} + y\) with \(y=V\alpha\), where \(V\) is the matrix with
the linear independent vectors from the null space of \(A\). The problem we
want to solve is
</p>
\begin{equation*}
  \min_{x: Ax = b} \lVert x \rVert_2
  = \min_{\alpha} \lVert \tilde{x} + V\alpha \rVert_2,
\end{equation*}
<p>
which is a least squares problem corresponding to the system of
equations \(V \alpha = - \tilde{x}\). Since the rank of \(V\) is 4, this
system is indeed over-determined and no solution will exist. The
best solution, therefore, comes from solving the associated least
squares problem to this linear system. Check that this solution is
equal to <code>pinv(A)*b</code>
</p></li>
</ol>
</div>
</div>
</div>
</div>

<div id="outline-container-org3ff283d" class="outline-2">
<h2 id="org3ff283d"><span class="section-number-2">8</span> Graphics</h2>
<div class="outline-text-2" id="text-8">
</div>

<div id="outline-container-org8ef8ec9" class="outline-3">
<h3 id="org8ef8ec9"><span class="section-number-3">8.1</span> Customizing plots</h3>
<div class="outline-text-3" id="text-8-1">
<p>
In this section we'll refresh/introduce some useful graphical
commands using examples.  First, let's make a data set and plot them.
</p>
<div class="org-src-container">
<pre class="src src-matlab">x = (0<span style="color: #b58900;">:</span>0.1<span style="color: #b58900;">:</span>15)<span style="color: #b58900;">'</span>;              <span style="color: #586e75;">% column vector</span>
y = [sin(x)<span style="color: #b58900;">./</span>x, exp(<span style="color: #b58900;">-</span>0.05<span style="color: #b58900;">*</span>x)<span style="color: #b58900;">.*</span>cos(.5<span style="color: #b58900;">*</span>x)]; <span style="color: #586e75;">% two columns</span>
plot(x,y);
</pre>
</div>

<div id="org7cb961b" class="figure">
<p><img src="plot3.png" alt="plot3.png" />
</p>
</div>

<p>
After you have created a plot you can use the figure window to edit
the figure.  For instance, you can add all kinds of labels, change
line types and line colors, etc.  If you want to use the same type of
plot for different parameter values of data sets, then it is
convenient to be able to do this type of figure customization
automatically using Matlab code.  This prevents repeating the
customization manually over and over again.
</p>

<p>
The next example shows the most common graphic customizations.
</p>
<div class="org-src-container">
<pre class="src src-matlab"><span style="color: #b58900;">figure</span>                          <span style="color: #586e75;">% create a new figure</span>
x = 0.1<span style="color: #b58900;">:</span>0.1<span style="color: #b58900;">:</span>7;
plot(x, 1<span style="color: #b58900;">./</span>x, <span style="color: #2aa198;">'r--'</span>, <span style="color: #2aa198;">'linewidth'</span>, 2); <span style="color: #586e75;">% set line color, line style and</span>
                                      <span style="color: #586e75;">% line width</span>
hold on                         <span style="color: #586e75;">% add the next plot in the same figure (axes)</span>

<span style="color: #586e75;">% With fplot we only have to specify the function and the range instead of</span>
<span style="color: #586e75;">% the x-y vectors.</span>
fplot(@(x) sin(x)<span style="color: #b58900;">./</span>x, [<span style="color: #b58900;">-</span>7 7], <span style="color: #2aa198;">'b'</span>);

grid on                         <span style="color: #586e75;">% add x- and y- grid lines</span>
<span style="color: #b58900;">axis</span>([<span style="color: #b58900;">-</span>7 7 <span style="color: #b58900;">-</span>2 4]);              <span style="color: #586e75;">% change visible axis</span>

<span style="color: #586e75;">% Change the default location and labels of the x-axis.</span>
<span style="color: #b58900;">set</span>(<span style="color: #268bd2;">gca</span>, <span style="color: #2aa198;">'xtick'</span>, <span style="color: #268bd2; font-weight: bold;">pi</span><span style="color: #b58900;">*</span>(<span style="color: #b58900;">-</span>2<span style="color: #b58900;">:</span>2));
<span style="color: #b58900;">set</span>(<span style="color: #268bd2;">gca</span>, <span style="color: #2aa198;">'xticklabel'</span>, {<span style="color: #2aa198;">'-2pi'</span>, <span style="color: #2aa198;">'pi'</span>, <span style="color: #2aa198;">'0'</span>, <span style="color: #2aa198;">'pi'</span>, <span style="color: #2aa198;">'2pi'</span>});

<span style="color: #586e75;">% Add some labels</span>
title(<span style="color: #2aa198;">'Example plot'</span>);
xlabel(<span style="color: #2aa198;">'Input'</span>);
ylabel(<span style="color: #2aa198;">'Output'</span>);
legend(<span style="color: #2aa198;">'Hyperbola'</span>, <span style="color: #2aa198;">'Damped sine'</span>, ...
       <span style="color: #2aa198;">'Location'</span>, <span style="color: #2aa198;">'NorthWest'</span>); <span style="color: #586e75;">% force the location of the legend</span>
</pre>
</div>

<div id="org08c1343" class="figure">
<p><img src="plot4.png" alt="plot4.png" />
</p>
</div>

<p>
The figure/axis/plot properties that you can access through the
figure window can also be changed using Matlab commands.  You can
use the commands <code>get</code> and <code>set</code> to retrieve and change these
settings.  As the first input argument these functions require a
so-called handle to a figure/axis/plot.  The standard functions <code>gcf</code>
(get current figure) and <code>gca</code> (get current axis) return the handles
to the current figure/axis.  Try the following commands and check the
results and try to change some setting using the command line.
</p>
<div class="org-src-container">
<pre class="src src-matlab"><span style="color: #b58900;">get</span>(<span style="color: #268bd2;">gcf</span>)
<span style="color: #b58900;">get</span>(<span style="color: #268bd2;">gca</span>)
<span style="color: #b58900;">get</span>(<span style="color: #268bd2;">gca</span>, <span style="color: #2aa198;">'ygrid'</span>);
<span style="color: #b58900;">set</span>(<span style="color: #268bd2;">gca</span>, <span style="color: #2aa198;">'ygrid'</span>, <span style="color: #2aa198;">'off'</span>);
</pre>
</div>

<p>
If you want to create multiple figures or plots, then using cell
arrays in combination with <code>sprintf</code> is useful to set labels/legends.
</p>
<div class="org-src-container">
<pre class="src src-matlab">x = (0<span style="color: #b58900;">:</span>0.01<span style="color: #b58900;">:</span>4)<span style="color: #b58900;">'</span>; mu = [0.5, 1, 2];
y = zeros(length(x), length(mu)); leg = cell(1,length(mu));
<span style="color: #859900;">for</span> <span style="color: #268bd2;">n</span>=<span style="color: #268bd2; font-weight: bold;">1:length(mu)</span>
  y(<span style="color: #b58900;">:</span>,n) = exp(<span style="color: #b58900;">-</span>mu(n)<span style="color: #b58900;">*</span>x);
  leg{n} = sprintf(<span style="color: #2aa198;">'\\mu = %.1f'</span>, mu(n));
<span style="color: #859900;">end</span>
plot(x, y);
legend(leg{<span style="color: #b58900;">:</span>});                 <span style="color: #586e75;">% passes the cells as arguments to legend</span>
</pre>
</div>

<div id="orgc5c6cf8" class="figure">
<p><img src="plot5.png" alt="plot5.png" />
</p>
</div>

<p>
In the example above, we have used a single <code>plot</code> statement, which is
convenient when you want multiple plots in one figure, because each
plots automatically gets its own color.  However, sometimes you build
up a figure by using several plot-like statements.  The default plot
color is blue, which means you'll need to specify different colors if
you want the plots to have different colors.  You can do this
manually, for instance:
</p>
<div class="org-src-container">
<pre class="src src-matlab"><span style="color: #b58900;">figure</span>;
x = <span style="color: #b58900;">-</span>3<span style="color: #b58900;">:</span>0.5<span style="color: #b58900;">:</span>3;                           <span style="color: #586e75;">% large step size</span>
plot(x, sin(x), <span style="color: #2aa198;">'b'</span>);                   <span style="color: #586e75;">% plot in blue</span>
hold on                                 <span style="color: #586e75;">% add new plots to the same figure</span>
x = <span style="color: #b58900;">-</span>3<span style="color: #b58900;">:</span>0.05<span style="color: #b58900;">:</span>3;                          <span style="color: #586e75;">% small step size</span>
plot(x, sin(x), <span style="color: #2aa198;">'r'</span>);                   <span style="color: #586e75;">% plot in red</span>
legend(<span style="color: #2aa198;">'Large step size'</span>, <span style="color: #2aa198;">'Small steps'</span>);
</pre>
</div>
<p>
This is okay if you only have two or three plots, but it not so
convenient if you have a more and/or arbitrary number of plots in the
same figure.  In that case, you can specify RGB colors&#x2014;color values
for red, green, and blue&#x2014;taken from a so-called <i>colormap</i>.  This
is illustrated by the following example.
</p>
<div class="org-src-container">
<pre class="src src-matlab"><span style="color: #586e75;">% Define parameter combinations</span>
mu_sigma = [  0,  1
              0,  3
              1,  0.5
             <span style="color: #b58900;">-</span>1,  2
           <span style="color: #b58900;">-</span>0.5,  0.8];

n   = size(mu_sigma, 1);                <span style="color: #586e75;">% number of plots</span>
x   = linspace(<span style="color: #b58900;">-</span>4, 4, 201);             <span style="color: #586e75;">% define the x-range</span>
leg = cell(n, 1);                       <span style="color: #586e75;">% initialize empty legend cell array</span>

<span style="color: #586e75;">% Get the RGB-colors from the 'lines' colormap</span>
colmap = lines(n);

<span style="color: #b58900;">figure</span>;
hold on
<span style="color: #859900;">for</span> <span style="color: #268bd2; font-weight: bold;">i</span>=<span style="color: #268bd2; font-weight: bold;">1:n</span>
    mu    = mu_sigma(<span style="color: #268bd2; font-weight: bold;">i</span>, 1);
    sigma = mu_sigma(<span style="color: #268bd2; font-weight: bold;">i</span>, 2);
    <span style="color: #586e75;">% Plot using the RGB-colors in the i-th row from the colormap</span>
    plot(x, normpdf(x, mu, sigma), <span style="color: #2aa198;">'color'</span>, colmap(<span style="color: #268bd2; font-weight: bold;">i</span>,<span style="color: #b58900;">:</span>));
    leg{<span style="color: #268bd2; font-weight: bold;">i</span>} = sprintf(<span style="color: #2aa198;">'N(%g, %g)'</span>, mu, sigma);
<span style="color: #859900;">end</span>
legend(leg{<span style="color: #b58900;">:</span>});
</pre>
</div>

<div id="orgfd7977e" class="figure">
<p><img src="colmap.png" alt="colmap.png" />
</p>
</div>

<p>
Instead of using the <code>lines</code> colormap, you could also use other
colormaps such as <code>gray</code>, <code>pink</code>, <code>cool</code>, <code>bone</code>, <code>copper</code>.
</p>
</div>
</div>

<div id="outline-container-org70be02a" class="outline-3">
<h3 id="org70be02a"><span class="section-number-3">8.2</span> 3D graphics</h3>
<div class="outline-text-3" id="text-8-2">
<p>
Making 3D plots is not much different than creating 2D plots.  Let's
see some examples.
</p>
<div class="org-src-container">
<pre class="src src-matlab">t = 0<span style="color: #b58900;">:</span>.1<span style="color: #b58900;">:</span>2<span style="color: #b58900;">*</span><span style="color: #268bd2; font-weight: bold;">pi</span>;
x = t<span style="color: #b58900;">.^</span>3<span style="color: #b58900;">.*</span>sin(3<span style="color: #b58900;">*</span>t)<span style="color: #b58900;">.*</span>exp(<span style="color: #b58900;">-</span>t);
y = t<span style="color: #b58900;">.^</span>3<span style="color: #b58900;">.*</span>cos(3<span style="color: #b58900;">*</span>t)<span style="color: #b58900;">.*</span>exp(<span style="color: #b58900;">-</span>t);
z = t<span style="color: #b58900;">.^</span>2;
plot3(x,y,z); grid on
</pre>
</div>

<div id="org4e0f429" class="figure">
<p><img src="plot6.png" alt="plot6.png" />
</p>
</div>

<div class="org-src-container">
<pre class="src src-matlab">n = 200;
x = randn(n,1);
y = randn(n,1);
z = randn(n,1);
plot3(x,y,z, <span style="color: #2aa198;">'.'</span>); grid on
</pre>
</div>

<div id="orgf377e99" class="figure">
<p><img src="plot7.png" alt="plot7.png" />
</p>
</div>

<p>
Things become more interesting if we want to plot a function with two
input arguments as a surface.  We need to create a xy-grid first,
which specifies all combinations of x and y values for which we
evaluate the function.  The following example illustrates the
<code>meshgrid</code> function.
</p>
<div class="org-src-container">
<pre class="src src-matlab">[x,y] = meshgrid(1<span style="color: #b58900;">:</span>5, [10, 20])
z = x <span style="color: #b58900;">+</span> y
</pre>
</div>
<pre class="example" id="org506c955">
x =

     1     2     3     4     5
     1     2     3     4     5


y =

    10    10    10    10    10
    20    20    20    20    20


z =

    11    12    13    14    15
    21    22    23    24    25
</pre>

<p>
How we can use the <code>meshgrid</code> function to create various 3D plots is
illustrated by the next example.
</p>
<div class="org-src-container">
<pre class="src src-matlab">[x,y] = meshgrid(<span style="color: #b58900;">-</span>3<span style="color: #b58900;">:</span>0.1<span style="color: #b58900;">:</span>3, <span style="color: #b58900;">-</span>2<span style="color: #b58900;">:</span>0.1<span style="color: #b58900;">:</span>2);
z = (x<span style="color: #b58900;">.^</span>2 <span style="color: #b58900;">-</span> 2<span style="color: #b58900;">*</span>x) <span style="color: #b58900;">.*</span> exp(<span style="color: #b58900;">-</span>x<span style="color: #b58900;">.^</span>2 <span style="color: #b58900;">-</span> y<span style="color: #b58900;">.^</span>2 <span style="color: #b58900;">-</span> x<span style="color: #b58900;">.*</span>y);

<span style="color: #b58900;">figure</span>;

<span style="color: #586e75;">% Create the first subplot of a figure with 6 (3x2) subplots</span>
subplot<span style="color: #b58900;">(3,2,1);</span>
mesh(x,y,z);

subplot<span style="color: #b58900;">(3,2,2);</span>
surf(x,y,z);

subplot<span style="color: #b58900;">(3,2,3);</span>
surf(x,y,z);
view(<span style="color: #b58900;">-</span>200, 30);

subplot<span style="color: #b58900;">(3,2,4);</span>
contour(x,y,z);

subplot<span style="color: #b58900;">(3,2,5);</span>
contour(x,y,z,30);

subplot<span style="color: #b58900;">(3,2,6);</span>
meshc(x,y,z);
colorbar;
</pre>
</div>

<div id="org1a7193f" class="figure">
<p><img src="plot9.png" alt="plot9.png" />
</p>
</div>

<p>
Sometimes your two-dimensional function is defined using a single
two-dimensional input argument instead of two one-dimensional input
arguments.  For instance,
</p>
<div class="org-src-container">
<pre class="src src-matlab">f = @(x,y) (x<span style="color: #b58900;">.^</span>2 <span style="color: #b58900;">-</span> 2<span style="color: #b58900;">*</span>x) <span style="color: #b58900;">.*</span> exp(<span style="color: #b58900;">-</span>x<span style="color: #b58900;">.^</span>2 <span style="color: #b58900;">-</span> y<span style="color: #b58900;">.^</span>2 <span style="color: #b58900;">-</span> x<span style="color: #b58900;">.*</span>y);
</pre>
</div>
<p>
defines the same function as
</p>
<div class="org-src-container">
<pre class="src src-matlab">g = @(x) (x(<span style="color: #b58900;">:</span>,1)<span style="color: #b58900;">.^</span>2 <span style="color: #b58900;">-</span> 2<span style="color: #b58900;">*</span>x(<span style="color: #b58900;">:</span>,1)) <span style="color: #b58900;">.*</span> exp(<span style="color: #b58900;">-</span>x(<span style="color: #b58900;">:</span>,1)<span style="color: #b58900;">.^</span>2 <span style="color: #b58900;">-</span> x(<span style="color: #b58900;">:</span>,2)<span style="color: #b58900;">.^</span>2 <span style="color: #b58900;">-</span> x(<span style="color: #b58900;">:</span>,1)<span style="color: #b58900;">.*</span>x(<span style="color: #b58900;">:</span>,2));
</pre>
</div>
<p>
Depending on the situation one could be prefered over the other.  In
the last case, it is a bit more complicated to create a 3D-figure,
because the output of <code>meshgrid</code> cannot be directly applied.
Fortunately, it is not too difficult to accomplish:
</p>
<div class="org-src-container">
<pre class="src src-matlab">[x,y] = meshgrid(<span style="color: #b58900;">-</span>3<span style="color: #b58900;">:</span>0.1<span style="color: #b58900;">:</span>3, <span style="color: #b58900;">-</span>2<span style="color: #b58900;">:</span>0.1<span style="color: #b58900;">:</span>2); <span style="color: #586e75;">% generate the grid as before</span>
X = [x(<span style="color: #b58900;">:</span>) y(<span style="color: #b58900;">:</span>)];                <span style="color: #586e75;">% put all (x,y) combinations from the grid in</span>
                                <span style="color: #586e75;">% the rows of a two-column matrix</span>
z = g(X);                       <span style="color: #586e75;">% evaluate the function (this will be a</span>
                                <span style="color: #586e75;">% column vector)</span>
z = reshape(z, size(x))         <span style="color: #586e75;">% reshape to the same size as x (and y)</span>
mesh(x,y,z)                     <span style="color: #586e75;">% generate the 3D mesh plot</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orga0c9f2b" class="outline-3">
<h3 id="orga0c9f2b"><span class="section-number-3">8.3</span> Exercise: probability distributions</h3>
<div class="outline-text-3" id="text-8-3">
<p>
For each of the plots that you make in this exercise make sure that
you give different plots a different color or line style and include
appropriate titles, axis labels and legends.
</p>

<ol class="org-ol">
<li>Plot the probability density function (pdf) for the normal
distribution with mean \(\mu=1\) and standard deviations \(\sigma =
   0.1, 0.5, 1, 2\) in one plot.</li>
<li>Do the same, in a new plot, for the gamma distribution. You can use
the following property: the shape parameter is \(\mu^2 / \sigma^2\)
and the scale parameter is \(\sigma^2 / \mu\).</li>
<li>Make another figure where you plot the pdf of both the normal and
gamma distribution. Take \(\mu=1\) and \(\sigma=1\) for both
distributions.</li>
<li>Draw 100 random numbers from the \(N(1,1)\) distribution.  In one
figure plot
<ol class="org-ol">
<li>The cdf of the \(N(1,1)\) distribution</li>
<li>The <i>empirical cdf</i> of the first 10, 30 and 100 observations,
respectively.  You can use <code>ecdf</code> for this puropose.  You can
also use <code>cdfplot</code>, but make sure that you give the plots
different colors.</li>
</ol></li>
</ol>
</div>
</div>
</div>

<div id="outline-container-orgc4de667" class="outline-2">
<h2 id="orgc4de667"><span class="section-number-2">9</span> Regression</h2>
<div class="outline-text-2" id="text-9">
</div>

<div id="outline-container-orgd843ae9" class="outline-3">
<h3 id="orgd843ae9"><span class="section-number-3">9.1</span> Introduction</h3>
<div class="outline-text-3" id="text-9-1">
<p>
Regression using the least squares criterion can be summarized by the
following optimization problem
</p>
\begin{equation*}
  \min_{x\in X} \sum_i F_i(x)^2
\end{equation*}

<p>
We distinguish the following functional forms for the function \(F\).
</p>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">\(F(x)\)</th>
<th scope="col" class="org-left">Constraints (\(X\))</th>
<th scope="col" class="org-left">Matlab solver</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">\(Ax-b\)</td>
<td class="org-left">None</td>
<td class="org-left"><code>\</code>, <code>mldivide</code> or <code>regress</code></td>
</tr>

<tr>
<td class="org-left">\(Ax-b\)</td>
<td class="org-left">\(x \geq 0\)</td>
<td class="org-left"><code>lsqnonneg</code></td>
</tr>

<tr>
<td class="org-left">\(Ax-b\)</td>
<td class="org-left">Bound, linear</td>
<td class="org-left"><code>lsqlin</code></td>
</tr>

<tr>
<td class="org-left">General \(F(x)\)</td>
<td class="org-left">Bound</td>
<td class="org-left"><code>lsqnonlin</code></td>
</tr>

<tr>
<td class="org-left">\(F(x, xdata)-ydata\)</td>
<td class="org-left">Bound</td>
<td class="org-left"><code>lsqcurvefit</code></td>
</tr>
</tbody>
</table>

<p>
The first case simply corresponds the the standard linear regression
(OLS) problem, which we discussed in the section about <a href="#orgc845b3b">Linear algebra</a>.
The second and third type are extensions to this problem where we put
a simple nonnegativity restriction on \(x\) or general linear
constraints. The last two types correspond to cases where the
objective is nonlinear.
</p>
</div>
</div>

<div id="outline-container-org24e0bd7" class="outline-3">
<h3 id="org24e0bd7"><span class="section-number-3">9.2</span> Linear regression</h3>
<div class="outline-text-3" id="text-9-2">
<p>
Suppose we have a quadratic function
</p>
\begin{equation*}
f(x) = \beta_1 x^2 + \beta_2 x + \beta_3
\end{equation*}
<p>
for which the coefficient \(\beta\) are unknown.  Observations are
available from the model
</p>
\begin{equation*}
y_i = f(x_i) + \varepsilon_i
\end{equation*}
<p>
How do we estimate the coefficients from the data?  Often students
think that they should use one of the nonlinear solvers, because
they are dealing with a quadratic model.  This is a mistake, because
the quadratic function is <i>linear</i> in its coefficients and that's
what counts.
</p>

<p>
We would solve this problem as follows.
</p>
<div class="org-src-container">
<pre class="src src-matlab"><span style="color: #586e75; font-weight: bold; text-decoration: overline;">%% First create some data to work with</span>
beta = [1 <span style="color: #b58900;">-</span>1 1]<span style="color: #b58900;">'</span>;               <span style="color: #586e75;">% the true coefficients</span>
m = 5;                          <span style="color: #586e75;">% number of observations</span>
sigma = 0.02;                   <span style="color: #586e75;">% st.dev</span>
x = rand(m,1);                  <span style="color: #586e75;">% the locations of the observations</span>
X = [x<span style="color: #b58900;">.^</span>2, x, ones(m,1)]        <span style="color: #586e75;">% data/regression matrix</span>
y = X<span style="color: #b58900;">*</span>beta <span style="color: #b58900;">+</span> normrnd(0, sigma, m, 1); <span style="color: #586e75;">% the perturbed y-values</span>

<span style="color: #586e75; font-weight: bold; text-decoration: overline;">%% Do the regression and some analysis</span>
b = X<span style="color: #b58900;">\</span>y;                        <span style="color: #586e75;">% estimate beta</span>
yhat = X<span style="color: #b58900;">*</span>b;                     <span style="color: #586e75;">% predictions</span>
e = y <span style="color: #b58900;">-</span> yhat;                   <span style="color: #586e75;">% errors</span>
sigmahat = sqrt(e<span style="color: #b58900;">'*</span>e<span style="color: #b58900;">/</span>(m<span style="color: #b58900;">-</span>length(b))); <span style="color: #586e75;">% estimate for sigma</span>

<span style="color: #586e75;">% Display results</span>
fprintf(1, <span style="color: #2aa198;">'Coefficients (true and estimated)\n'</span>);
fprintf(1, <span style="color: #2aa198;">'%8g %8.4f\n'</span>, [beta, b]<span style="color: #b58900;">'</span>);
fprintf(1, <span style="color: #2aa198;">'\nStandard deviation (true and estimated)\n'</span>);
fprintf(1, <span style="color: #2aa198;">'%8g %8.4f\n'</span>, [sigma, sigmahat]<span style="color: #b58900;">'</span>);

<span style="color: #586e75; font-weight: bold; text-decoration: overline;">%% Do some visualization</span>
fun = @(x,beta) beta(1)<span style="color: #b58900;">*</span>x<span style="color: #b58900;">.^</span>2 <span style="color: #b58900;">+</span> beta(2)<span style="color: #b58900;">*</span>x <span style="color: #b58900;">+</span> beta(3);

<span style="color: #b58900;">figure</span>;
<span style="color: #586e75;">%plot(x, y, 'k.', 'markersize', 12);</span>
scatter(x, y, <span style="color: #2aa198;">'k'</span>, <span style="color: #2aa198;">'filled'</span>);
hold on
fplot(@(x) fun(x,beta), [0 1], <span style="color: #2aa198;">'r'</span>);
fplot(@(x) fun(x,b), [0 1], <span style="color: #2aa198;">'b'</span>);

legend(<span style="color: #2aa198;">'Observations'</span>, <span style="color: #2aa198;">'True function'</span>, <span style="color: #2aa198;">'Estimated function'</span>);
</pre>
</div>
<pre class="example" id="org9ae9f90">
Coefficients (true and estimated)
       1   1.5244
      -1  -1.4362
       1   1.0685

Standard deviation (true and estimated)
    0.02   0.0176
</pre>

<div id="org80b5de2" class="figure">
<p><img src="plot10.png" alt="plot10.png" />
</p>
</div>
</div>
</div>

<div id="outline-container-orgc29139c" class="outline-3">
<h3 id="orgc29139c"><span class="section-number-3">9.3</span> Nonlinear regression</h3>
<div class="outline-text-3" id="text-9-3">
<p>
Now consider the situation where we have observations from the model
</p>
\begin{equation*}
  y_i = \alpha_1 \exp(\alpha_{2} x_i) + \varepsilon
\end{equation*}
<p>
We want to estimate \(\alpha\) by solving
</p>
\begin{equation*}
  \min_{\alpha} \sum_i (y_{i} - \alpha_{1} e^{\alpha_{2}x_i})^2
  \quad\Leftrightarrow\quad
  \min_{\alpha} \| y - f_x(\alpha) \|^2
\end{equation*}
<p>
with
</p>
\begin{equation*}
  f_{x}(\alpha) =
  \begin{bmatrix}
    \alpha_1 e^{\alpha_2 x_1} \\
    \vdots \\
    \alpha_1 e^{\alpha_2 x_{m}}
  \end{bmatrix}
\end{equation*}
<p>
and Jacobian matrix
</p>
\begin{equation*}
  Jf_x(\alpha) =
  \begin{bmatrix}
    e^{\alpha_2 x_1} & \alpha_1 x_{1} e^{\alpha_2 x_1} \\
    \vdots & \vdots \\
    e^{\alpha_2 x_m} & \alpha_1 x_m e^{\alpha_2 x_m}
  \end{bmatrix}
\end{equation*}
<p>
Note that we consider the function \(f\) as a function with two
arguments, but for our purposes we choose \(\alpha\) as its main (first)
argument.  The Jacobian information can be passed on the Matlab
solver, which makes the optimization more efficient.  In Matlab we can
create a m-file function:
</p>
<div class="org-src-container">
<pre class="src src-matlab"><span style="color: #859900;">function</span> <span style="color: #268bd2;">[f,Jf]</span> = <span style="color: #268bd2;">nonlinfun</span>(<span style="color: #268bd2;">a</span>,<span style="color: #268bd2;">x</span>)

<span style="color: #586e75;">% We split the computation, because we can reuse the results in the Jacobian</span>
<span style="color: #586e75;">% evaluation.</span>
y = exp(a(2)<span style="color: #b58900;">*</span>x);
f = a(1)<span style="color: #b58900;">*</span>y;

<span style="color: #586e75;">% Return the Jacobian only if asked for</span>
<span style="color: #859900;">if</span> nargout <span style="color: #b58900;">&gt;</span> 1
  Jf = [y, x<span style="color: #b58900;">.*</span>f];
<span style="color: #859900;">end</span>
</pre>
</div>
<p>
We solve the problem using <code>lsqcurvefit</code>.
</p>
<div class="org-src-container">
<pre class="src src-matlab"><span style="color: #586e75;">% Define function and true parameter</span>
a = [4; <span style="color: #b58900;">-</span>1];
truefun = @(x)(nonlinfun(a,x)); <span style="color: #586e75;">% the true function</span>

<span style="color: #586e75;">% Create a data set</span>
x = (0<span style="color: #b58900;">:</span>0.1<span style="color: #b58900;">:</span>1)<span style="color: #b58900;">'</span>;
y = truefun(x) <span style="color: #b58900;">+</span> 0.3<span style="color: #b58900;">*</span>randn(size(x)); <span style="color: #586e75;">% add some noise</span>

<span style="color: #586e75; font-weight: bold; text-decoration: overline;">%% Try to estimate parameter 'a' using data (x,y)</span>

<span style="color: #586e75;">% initial estimate, no lower/upper bounds</span>
a0 = [1; 1]; lb = []; ub = [];

<span style="color: #586e75;">% Change some solver options: gradient is specified as second output</span>
<span style="color: #586e75;">% argument of function (SpecifyObjectiveGradient) and check whether this</span>
<span style="color: #586e75;">% gradient is correct (CheckGradients)</span>
opt = optimoptions(<span style="color: #2aa198;">'lsqcurvefit'</span>, ...
                   <span style="color: #2aa198;">'Display'</span>, <span style="color: #2aa198;">'iter'</span>, ...
                   <span style="color: #2aa198;">'SpecifyObjectiveGradient'</span>, <span style="color: #268bd2; font-weight: bold;">true</span>, ...
                   <span style="color: #2aa198;">'CheckGradients'</span>, <span style="color: #268bd2; font-weight: bold;">true</span>);

<span style="color: #586e75;">% Estimate 'a'</span>
ahat = lsqcurvefit(@nonlinfun, a0, x, y, lb, ub, opt);

<span style="color: #586e75;">% Anonymous function for the estimated function by pluggin in the estimate</span>
estimfun = @(x) nonlinfun(ahat,x);

<span style="color: #586e75;">% Plot the results</span>
clf; plot(x, y, <span style="color: #2aa198;">'.'</span>);
hold on; grid on
fplot(truefun, [0 1], <span style="color: #2aa198;">'r'</span>);
fplot(estimfun, [0 1], <span style="color: #2aa198;">'m'</span>);
legend(<span style="color: #2aa198;">'data'</span>, <span style="color: #2aa198;">'true function'</span>, <span style="color: #2aa198;">'estimated function'</span>);
</pre>
</div>

<div id="org66edc24" class="figure">
<p><img src="nonlin1.png" alt="nonlin1.png" />
</p>
</div>
</div>
</div>

<div id="outline-container-org71d448e" class="outline-3">
<h3 id="org71d448e"><span class="section-number-3">9.4</span> Exercises</h3>
<div class="outline-text-3" id="text-9-4">
</div>
<div id="outline-container-org6d81458" class="outline-4">
<h4 id="org6d81458"><span class="section-number-4">9.4.1</span> Nonlinear regression</h4>
<div class="outline-text-4" id="text-9-4-1">
<p>
The data below can be modeled by the equation
</p>
\begin{equation*}
y = \left( \frac{a + \sqrt{x}} {b \sqrt{x}} \right)^2 + \varepsilon
\end{equation*}

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-right" />

<col  class="org-right" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-right">x</th>
<th scope="col" class="org-right">y</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-right">0.5</td>
<td class="org-right">11.1</td>
</tr>

<tr>
<td class="org-right">1.0</td>
<td class="org-right">6.3</td>
</tr>

<tr>
<td class="org-right">2.0</td>
<td class="org-right">3.7</td>
</tr>

<tr>
<td class="org-right">3.0</td>
<td class="org-right">2.7</td>
</tr>

<tr>
<td class="org-right">4.0</td>
<td class="org-right">2.3</td>
</tr>
</tbody>
</table>

<p>
Determine the parameters \(a\) and \(b\) by nonlinear regression
</p>
<ol class="org-ol">
<li>using <code>lsqcurvefit</code></li>
<li>using <code>lsqnonlin</code></li>
<li>using <code>fminsearch</code></li>
</ol>

<p>
Plot the estimated model in a figure and also display the original
data set.
</p>

<p>
<i>Hints.</i> Anonymous functions will be very useful here. Define
anonymous functions for the model and each of the objectives to be
minimized for <code>lsqcurvefit</code>, <code>lsqnonlin</code> and <code>fminsearch</code>. Carefully
look at the required input/output arguments for these objective
functions.
</p>
<ol class="org-ol">
<li><code>lsqcurvefit</code> needs the model function where the parameters are the
first argument (\(a\) and \(b\) combined in a vector of size 2), and
the data the second.</li>
<li><code>lsqnonlin</code> only needs the vector of errors as a function of the
parameter. This can easily be derived using the model defined
for <code>lsqcurvefit</code>.</li>
<li><code>fminsearch</code> needs only the sum of squares (i.e., a scalar) as a
function of the parameter. Again, this is easy using the error
function defined for <code>lsqnonlin</code>.</li>
</ol>
</div>
</div>

<div id="outline-container-orgd51bdae" class="outline-4">
<h4 id="orgd51bdae"><span class="section-number-4">9.4.2</span> Estimating a full quadratic model using linear regression</h4>
<div class="outline-text-4" id="text-9-4-2">
<p>
Consider the full quadratic model
</p>
\begin{equation*}
  y_i = c + b^Tx_i + x_i^TAx_i + \varepsilon_i
\end{equation*}
<p>
where \(x_i \in \mathbb{R}^n\), \(A \in \mathbb{R}^{n \times n}\), \(b \in \mathbb{R}^n\) and \(c \in
R\).  We assume that \(A\) is symmetric, thus \(A\), \(b\) and \(c\) combined
form a total of \((n+1)(n+2)/2\) coefficients.  Note that the model is
linear in these coefficients, hence the coefficients can be estimated
by linear regression.  This implies that there exist functions
</p>
\begin{equation*}
  r: \mathbb{R}^n \rightarrow \mathbb{R}^{(n+1)(n+2)/2}
  \qquad\text{and}\qquad
  \alpha: \mathbb{R}^{n \times n} \times \mathbb{R}^n \times \mathbb{R} \rightarrow \mathbb{R}^{(n+1)(n+2)/2}
\end{equation*}
<p>
such that
</p>
\begin{align*}
  c + b^Tx + x^TAx
&= c + \sum_i b_i x_{i} + \sum_i \sum_j A_{ij} x_{i} x_{j} \\
&= \sum_k \alpha_k(A,b,c) r_k(x) \\
&=  r(x)^T \alpha(A,b,c).
\end{align*}
<p>
In Matlab, the vector \(r(x)\) can be created using the <code>x2fx</code> function
(look at the documentation for this function).  The function \(\alpha\)
is a straightforward transformation of the coefficients \(A\), \(b\) and
\(c\).  E.g.,
</p>
<ul class="org-ul">
<li>\(r_1(x)=1\) and \(\alpha_1(A,b,c)=c\),</li>
<li>\(r_{i+1}(x)=x_i\) and \(\alpha_{i+1}(A,b,c)=b_i\) for \(i=1,\dots,n\),</li>
<li>\(r_{n+2}(x)=x_1 x_2\) and \(\alpha_{n+2}(A,b,c)=A_{12}\), etc.</li>
</ul>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-right">x(1)</th>
<th scope="col" class="org-right">x(2)</th>
<th scope="col" class="org-right">x(3)</th>
<th scope="col" class="org-right">y</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-right">0.7269</td>
<td class="org-right">-0.1649</td>
<td class="org-right">-1.4916</td>
<td class="org-right">7.5925</td>
</tr>

<tr>
<td class="org-right">-0.3034</td>
<td class="org-right">0.6277</td>
<td class="org-right">-0.7423</td>
<td class="org-right">9.8878</td>
</tr>

<tr>
<td class="org-right">0.2939</td>
<td class="org-right">1.0933</td>
<td class="org-right">-1.0616</td>
<td class="org-right">14.9603</td>
</tr>

<tr>
<td class="org-right">-0.7873</td>
<td class="org-right">1.1093</td>
<td class="org-right">2.3505</td>
<td class="org-right">19.1152</td>
</tr>

<tr>
<td class="org-right">0.8884</td>
<td class="org-right">-0.8637</td>
<td class="org-right">-0.6156</td>
<td class="org-right">9.5911</td>
</tr>

<tr>
<td class="org-right">-1.1471</td>
<td class="org-right">0.0774</td>
<td class="org-right">0.7481</td>
<td class="org-right">6.0004</td>
</tr>

<tr>
<td class="org-right">-1.0689</td>
<td class="org-right">-1.2141</td>
<td class="org-right">-0.1924</td>
<td class="org-right">7.1351</td>
</tr>

<tr>
<td class="org-right">-0.8095</td>
<td class="org-right">-1.1135</td>
<td class="org-right">0.8886</td>
<td class="org-right">9.6753</td>
</tr>

<tr>
<td class="org-right">-2.9443</td>
<td class="org-right">-0.0068</td>
<td class="org-right">-0.7648</td>
<td class="org-right">58.0111</td>
</tr>

<tr>
<td class="org-right">1.4384</td>
<td class="org-right">1.5326</td>
<td class="org-right">-1.4023</td>
<td class="org-right">22.5375</td>
</tr>

<tr>
<td class="org-right">0.3252</td>
<td class="org-right">-0.7697</td>
<td class="org-right">-1.4224</td>
<td class="org-right">7.0363</td>
</tr>

<tr>
<td class="org-right">-0.7549</td>
<td class="org-right">0.3714</td>
<td class="org-right">0.4882</td>
<td class="org-right">4.4605</td>
</tr>

<tr>
<td class="org-right">1.3703</td>
<td class="org-right">-0.2256</td>
<td class="org-right">-0.1774</td>
<td class="org-right">11.7823</td>
</tr>

<tr>
<td class="org-right">-1.7115</td>
<td class="org-right">1.1174</td>
<td class="org-right">-0.1961</td>
<td class="org-right">35.6122</td>
</tr>

<tr>
<td class="org-right">-0.1022</td>
<td class="org-right">-1.0891</td>
<td class="org-right">1.4193</td>
<td class="org-right">20.4914</td>
</tr>

<tr>
<td class="org-right">-0.2414</td>
<td class="org-right">0.0326</td>
<td class="org-right">0.2916</td>
<td class="org-right">1.0463</td>
</tr>

<tr>
<td class="org-right">0.3192</td>
<td class="org-right">0.5525</td>
<td class="org-right">0.1978</td>
<td class="org-right">2.4877</td>
</tr>

<tr>
<td class="org-right">0.3129</td>
<td class="org-right">1.1006</td>
<td class="org-right">1.5877</td>
<td class="org-right">12.2703</td>
</tr>

<tr>
<td class="org-right">-0.8649</td>
<td class="org-right">1.5442</td>
<td class="org-right">-0.8045</td>
<td class="org-right">36.4001</td>
</tr>

<tr>
<td class="org-right">-0.0301</td>
<td class="org-right">0.0859</td>
<td class="org-right">0.6966</td>
<td class="org-right">2.5647</td>
</tr>
</tbody>
</table>

<ol class="org-ol">
<li>Import the data in the table above in Matlab.</li>

<li>Create the regression matrix \(R\) (using <code>x2fx</code>) for the full
quadratic model and estimate the coefficient vector \(\hat\alpha\).</li>

<li>Derive the estimates \(\hat A\), \(\hat b\) and \(\hat c\) from
\(\hat\alpha\). You'll need to match up the entries of the regression
matrix and the parameters \(A\), \(b\) and \(c\). See the documentation
for <code>x2fx</code>. The most difficult part is to fill the interaction
terms in the matrix \(A\). Try to find a link between the variables
that works for general dimension \(n\). It's okay to use a loop here,
even though it can be done without. If that's still too difficult,
then just get the link for \(n=3\).</li>

<li>Verify that \(r(x)^T \hat\alpha = x^T\hat{A}x + \hat{b}^Tx +
   \hat{c}\) for an arbitrary \(x\in \mathbb{R}^3\).</li>

<li>Verify that the estimated quadratic function is convex.  Note that
this can be easily derived from \(\hat{A}\), but not from
\(\hat{\alpha}\).</li>

<li>Fix \(x_3=0\) and generate a 3D visualization of the estimated
quadratic function for the range \(x_1,x_2 \in [-2, 2]\).</li>
</ol>
</div>
</div>
</div>
</div>

<div id="outline-container-org7d9b66b" class="outline-2">
<h2 id="org7d9b66b"><span class="section-number-2">10</span> Interpolation</h2>
<div class="outline-text-2" id="text-10">
<p>
Sometimes we want our estimating function to pass through the
observations, i.e., the estimate is equal to the observation.  In that
case, regression is not an option and we need to apply an
interpolating method.
</p>
</div>

<div id="outline-container-org2f89b90" class="outline-3">
<h3 id="org2f89b90"><span class="section-number-3">10.1</span> One-dimensional interpolation</h3>
<div class="outline-text-3" id="text-10-1">
<p>
The one-dimensional interpolation problem is summarized as follows.
</p>
<ul class="org-ul">
<li>Given data: \(x,y \in \mathbb{R}^{n}\)</li>
<li>Find an interpolating function \(f(x)\) such that \[f(x_{i})=y_{i}\]</li>
<li>Evaluate the interpolating function for the points \(v_1,\dots,v_m\)</li>
</ul>

<p>
In Matlab this problem is easily solved using <code>interp1(x,y,v,method)</code>
where <code>method</code> is one of
</p>
<ul class="org-ul">
<li><code>nearest</code></li>
<li><code>linear</code></li>
<li><code>spline</code>: cubic (3th degree) interpolation &rarr; smooth result</li>
<li><code>cubic</code>: piecewise cubic &rarr; preserves shape and
monotonicity</li>
</ul>

<p>
This is illustrated by the following example:
</p>
<div class="org-src-container">
<pre class="src src-matlab">x = [0 1 3 5 6 8 10]<span style="color: #b58900;">'</span>;
y = sin(x);
v = (0<span style="color: #b58900;">:</span>.1<span style="color: #b58900;">:</span>10)<span style="color: #b58900;">'</span>;
f = [interp1(x,y,v,<span style="color: #2aa198;">'linear'</span>), ...
     interp1(x,y,v,<span style="color: #2aa198;">'spline'</span>), ...
     interp1(x,y,v,<span style="color: #2aa198;">'cubic'</span>)];
h = plot(x, y, <span style="color: #2aa198;">'.'</span>, v, f);
<span style="color: #b58900;">set</span>(h(<span style="color: #268bd2;">1</span>), <span style="color: #2aa198;">'markersize'</span>, 18); grid on
legend(<span style="color: #2aa198;">'Data'</span>, <span style="color: #2aa198;">'Linear'</span>, <span style="color: #2aa198;">'Spline'</span>, <span style="color: #2aa198;">'Cubic'</span>, <span style="color: #2aa198;">'Location'</span>, <span style="color: #2aa198;">'North'</span>);
</pre>
</div>

<div id="org98379b0" class="figure">
<p><img src="interpolate1.png" alt="interpolate1.png" />
</p>
</div>
</div>
</div>

<div id="outline-container-org15cd685" class="outline-3">
<h3 id="org15cd685"><span class="section-number-3">10.2</span> Higher-dimensional interpolation</h3>
<div class="outline-text-3" id="text-10-2">
<p>
Two-dimensional interpolation is solved very similarly using
<code>interp2</code>.  Higher dimension interpolation problems are supported by
the functions <code>interp3</code>, <code>interpn</code> and <code>ndgrid</code>.
</p>
</div>
</div>

<div id="outline-container-orgdcf548f" class="outline-3">
<h3 id="orgdcf548f"><span class="section-number-3">10.3</span> Interpolation of scattered data</h3>
<div class="outline-text-3" id="text-10-3">
<p>
The interpolation methods we have discussed so far all require that
the observations are on a grid.  Hence, for the two-dimensional
interpolation problem, this implies that the observations
\((x_i,y_i,z_i)\) can be represented by three matrices <code>X</code>, <code>Y</code> and <code>Z</code>
where the matrices <code>X</code> and <code>Y</code> are a grid as produced by <code>meshgrid</code>.
</p>

<p>
Sometimes the observation locations \((x_i,y_i)\) are scattered
throughout the plane.  In that case, we have to use an alternative
method.  The official Matlab <a href="http://www.mathworks.nl/help/matlab/math/interpolating-scattered-data.html">documentation</a>, gives some nice examples
for the functions that you can use in that case.  In the next section,
we shall consider yet another approach.
</p>
</div>
</div>

<div id="outline-container-orgbac8eb8" class="outline-3">
<h3 id="orgbac8eb8"><span class="section-number-3">10.4</span> Interpolation using Radial Basis Functions</h3>
<div class="outline-text-3" id="text-10-4">
<p>
Consider a scattered data set
</p>
\begin{equation*}
X = 
\begin{bmatrix} x_1^T \\ \vdots \\ x_m^T \end{bmatrix} \in
\mathbb{R}^{m \times n} 
\qquad\text{and}\qquad
y = \begin{bmatrix} y_1 \\ \vdots \\ y_m \end{bmatrix} \in \mathbb{R}^m
\end{equation*}
<p>
An interpolating Radial Basis Function model is given by
</p>
\begin{equation*}
f(x) = \sum_{j=1}^m \beta_j h_j(x),
\end{equation*}
<p>
where \(h_j(x)\) is
</p>
\begin{equation*}
h_j(x) = \phi(\| x - x_j \|).
\end{equation*}
<p>
The function \(\phi: \mathbb{R} \rightarrow \mathbb{R}\) is a radial
basis function, such as
</p>
<ul class="org-ul">
<li>linear : \(\phi(t) = t\)</li>
<li>gaussian : \(\phi(t) = \exp(-ct^2)\) for some \(c>0\)</li>
<li>multiquadric : \(\phi(t) = \sqrt{t^2+c^2}\) for some \(c>0\)</li>
<li>thin plate spline : \(\phi(t) = t^2 \log t\)</li>
</ul>

<p>
Note that the model has \(m\) coefficients \(\beta_j\) and \(m\) basis
functions, which are both equal to the number of observations.  The
coefficients can be estimated from the <i>linear</i> system of equations
</p>
\begin{equation*}
\Phi \beta = y
\qquad\text{with}\qquad
\Phi_{ij} = h_j(x_i) = \phi(\|x_i-x_j\|), \quad i,j=1,\dots,m.
\end{equation*}
<p>
If we substitute all results in our model, then we get an
interpolating function \(f(x)\).  Note that for the Gaussian and
multiquadric class of basis functions we still have a free parameter
\(c\).  It's value can be changed&#x2014;but you'll have to estimate the
coefficients again&#x2014;and it determines the smoothness of the model.
It can be selected based upon your preferences, or even better, by
minimizing some error criterion.
</p>

<p>
<i>Remark:</i> If the \(m\) observations are all unique, then the matrix
\(\Phi\) is guaranteed to be nonsingular.  Unfortunately, when the
number of observations \(m\) increases, then numerical instabilities can
arise because rows become nearly dependent.
</p>
</div>
</div>

<div id="outline-container-org5f8faf8" class="outline-3">
<h3 id="org5f8faf8"><span class="section-number-3">10.5</span> Exercise: interpolation</h3>
<div class="outline-text-3" id="text-10-5">
<p>
Load the data in the file <a href="scattered.txt">scattered.txt</a>, which gives some
observations (in the third column) of a two-dimensional model.
</p>

<ol class="org-ol">
<li>Visualize an interpolating surface using any of the built-in
methods in a 3D figure that also shows the observations marked by
points.</li>

<li>Try to produce some interpolating radial basis approximations using
several choices for the radial basis function class and associated
constant.  Again visualize the results.  Your solution to the
exercise about the <a href="#org56324c3">Euclidean distance</a> might be useful in creating
the \(\Phi\) matrix.</li>
</ol>
</div>
</div>
</div>
</div>
<div id="postamble" class="status">
<p class="author">Author: Ruud Brekelmans (<a href="mailto:R.C.M.Brekelmans@tilburguniversity.edu">R.C.M.Brekelmans@tilburguniversity.edu</a>)</p>
<p class="date">Date: 2021-01-12</p>
<p class="creator"><a href="https://www.gnu.org/software/emacs/">Emacs</a> 27.1 (<a href="https://orgmode.org">Org</a> mode )</p>
</div>
</body>
</html>
